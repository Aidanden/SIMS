# ๐ Admin ูุณุชุทูุน ุฅูุดุงุก ูุญุงุถุฑ ูุฃู ุดุฑูุฉ

## โ ุงูุชุญุฏูุซ ุงูููููุฐ

ุชู ุชูููู Admin ูู ุฅูุดุงุก ูุญุงุถุฑ ุฅุชูุงู ูุฃู ุดุฑูุฉ ูุฎุชุงุฑูุงุ ุญุชู ูู ูุงู ูุฑุจูุทุงู ุจุดุฑูุฉ ูุนููุฉ (ูุซู ุงูุชูุงุฒู).

---

## ๐ฏ ุงููุดููุฉ ุงูุณุงุจูุฉ

```
โ Admin ูุฑุจูุท ุจุดุฑูุฉ ุงูุชูุงุฒู
โ ูุง ูุณุชุทูุน ุฅูุดุงุก ูุญุงุถุฑ ููุดุฑูุงุช ุงูุฃุฎุฑู
โ ูุง ูุณุชุทูุน ุงูุจุญุซ ุนู ุฃุตูุงู ุงูุดุฑูุงุช ุงูุฃุฎุฑู
โ Backend ูุฃุฎุฐ companyId ูู ุงูู user ููุท
```

---

## โ ุงูุญู ุงูููููุฐ

### 1๏ธโฃ **Backend: ูุจูู companyId ูู ุงูู Request**
```typescript
// ูู DamageReportController.ts
const userCompanyId = (req as any).user?.companyId;
const isSystemUser = (req as any).user?.isSystemUser || false;

// ุฅุฐุง ูุงู System Userุ ููููู ุชุญุฏูุฏ ุงูุดุฑูุฉ ูู ุงูู request body
const companyId = isSystemUser && data.companyId 
  ? data.companyId 
  : userCompanyId;
```

### 2๏ธโฃ **DTO: ุฅุถุงูุฉ companyId ุงุฎุชูุงุฑู**
```typescript
// ูู damageReportDto.ts
export interface CreateDamageReportDto {
  companyId?: number; // ููู Admin ููุท - ูุชุญุฏูุฏ ุงูุดุฑูุฉ
  reason: string;
  notes?: string;
  lines: CreateDamageReportLineDto[];
}
```

### 3๏ธโฃ **Frontend: ุฅุฑุณุงู companyId ุงููุฎุชุงุฑ**
```typescript
// ูู damage-reports/page.tsx
const result = await createDamageReport({
  companyId: isSystemUser ? selectedCompanyId! : undefined,
  reason,
  notes: notes || undefined,
  lines: lines.map(l => ({...})),
}).unwrap();
```

---

## ๐จ ููู ูุนูู ุงููุธุงู ุงูุขู

### ููู Admin (System User):

#### 1. ุงุฎุชูุงุฑ ุงูุดุฑูุฉ:
```
ุงูุดุฑูุฉ: [ุงููุฑุน ุงูุดุฑูู โผ]
         โโ ุฌููุน ุงูุดุฑูุงุช
         โโ ุดุฑูุฉ ุงูุชูุงุฒู
         โโ ุงููุฑุน ุงูุดุฑูู  โ ูุฎุชุงุฑ
         โโ ุงููุฑุน ุงูุบุฑุจู
```

#### 2. ุงูุจุญุซ ุนู ุงูุฃุตูุงู:
```
โ ูุฑู ุฃุตูุงู ุงููุฑุน ุงูุดุฑูู
โ ูุฑู ุฃุตูุงู ุงูุชูุงุฒู (ุงูุดุฑูุฉ ุงูุฃู)
โ ูุง ูุฑู ุฃุตูุงู ุงููุฑุน ุงูุบุฑุจู
```

#### 3. ุฅูุดุงุก ุงููุญุถุฑ:
```
โ ูููุดุฆ ุงููุญุถุฑ ูููุฑุน ุงูุดุฑูู
โ ููุฎุตู ูู ูุฎุฒูู ุงููุฑุน ุงูุดุฑูู
โ ุฑูู ุงููุญุถุฑ: DMG-EAST-202411-0001
```

#### 4. ุงูุชุจุฏูู ุฅูู ุดุฑูุฉ ุฃุฎุฑู:
```
ุงูุดุฑูุฉ: [ุงููุฑุน ุงูุบุฑุจู โผ]  โ ุชุจุฏูู

โ ูุฑู ุฃุตูุงู ุงููุฑุน ุงูุบุฑุจู
โ ูุฑู ุฃุตูุงู ุงูุชูุงุฒู
โ ูููุดุฆ ูุญุถุฑ ูููุฑุน ุงูุบุฑุจู
```

### ูููุณุชุฎุฏู ุงูุนุงุฏู:
```
โ ูุง ูุฑู ูุงุฆูุฉ ุงุฎุชูุงุฑ ุงูุดุฑูุฉ
โ ูุฑู ููุท ุฃุตูุงู ุดุฑูุชู
โ ูููุดุฆ ูุญุถุฑ ูุดุฑูุชู ููุท
```

---

## ๐ง ุงูุชุบููุฑุงุช ุงูุชูููุฉ

### Backend:

#### 1. Controller (`DamageReportController.ts`):
```typescript
// ูุจู:
const companyId = (req as any).user?.companyId;

// ุจุนุฏ:
const userCompanyId = (req as any).user?.companyId;
const isSystemUser = (req as any).user?.isSystemUser || false;

const companyId = isSystemUser && data.companyId 
  ? data.companyId 
  : userCompanyId;

if (!companyId) {
  res.status(400).json({
    success: false,
    message: 'ูุฌุจ ุชุญุฏูุฏ ุงูุดุฑูุฉ',
  });
  return;
}
```

#### 2. DTO (`damageReportDto.ts`):
```typescript
export interface CreateDamageReportDto {
  companyId?: number; // ุฌุฏูุฏ
  reason: string;
  notes?: string;
  lines: CreateDamageReportLineDto[];
}
```

### Frontend:

#### 1. API (`damageReportsApi.ts`):
```typescript
export interface CreateDamageReportDto {
  companyId?: number; // ุฌุฏูุฏ
  reason: string;
  notes?: string;
  lines: {...}[];
}
```

#### 2. Component (`damage-reports/page.tsx`):
```typescript
// ุงูุชุญูู ูุจู ุงูุฅุฑุณุงู
if (isSystemUser && !selectedCompanyId) {
  showError('ูุฑุฌู ุงุฎุชูุงุฑ ุงูุดุฑูุฉ ุฃููุงู');
  return;
}

// ุฅุฑุณุงู companyId
const result = await createDamageReport({
  companyId: isSystemUser ? selectedCompanyId! : undefined,
  reason,
  notes: notes || undefined,
  lines: lines.map(l => ({...})),
}).unwrap();
```

---

## ๐ ุณููุงุฑูููุงุช ุงูุงุณุชุฎุฏุงู

### ุณููุงุฑูู 1: Admin ููุดุฆ ูุญุถุฑ ูููุฑุน ุงูุดุฑูู
```
1. Admin (ูุฑุจูุท ุจุงูุชูุงุฒู) ูุณุฌู ุงูุฏุฎูู
2. ูุฎุชุงุฑ "ุงููุฑุน ุงูุดุฑูู" ูู ุงููุงุฆูุฉ
3. ูุจุญุซ ุนู ุฃุตูุงู ุงููุฑุน ุงูุดุฑูู
4. ูุถูู ุงูุฃุตูุงู ุงูุชุงููุฉ
5. ูููุดุฆ ุงููุญุถุฑ
6. โ ุงููุญุถุฑ ูููุดุฃ ูููุฑุน ุงูุดุฑูู
7. โ ุงููููุงุช ุชูุฎุตู ูู ูุฎุฒูู ุงููุฑุน ุงูุดุฑูู
8. โ ุฑูู ุงููุญุถุฑ: DMG-EAST-202411-0001
```

### ุณููุงุฑูู 2: Admin ูุจุฏู ุจูู ุงูุดุฑูุงุช
```
1. Admin ูุฎุชุงุฑ "ุงููุฑุน ุงูุดุฑูู"
2. ูููุดุฆ ูุญุถุฑ ูููุฑุน ุงูุดุฑูู
3. ูุจุฏู ุฅูู "ุงููุฑุน ุงูุบุฑุจู"
4. ูููุดุฆ ูุญุถุฑ ูููุฑุน ุงูุบุฑุจู
5. โ ูู ูุญุถุฑ ูุฑุจูุท ุจุดุฑูุชู ุงูุตุญูุญุฉ
```

### ุณููุงุฑูู 3: Admin ููุณู ุงุฎุชูุงุฑ ุงูุดุฑูุฉ
```
1. Admin ููุชุญ ุงูุตูุญุฉ
2. ูู ูุฎุชุฑ ุดุฑูุฉ (ุฃู ุงุฎุชุงุฑ "ุฌููุน ุงูุดุฑูุงุช")
3. ูุญุงูู ุฅูุดุงุก ูุญุถุฑ
4. โ ุฒุฑ ุงูุฅูุดุงุก ูุนุทู
5. โน๏ธ ุฑุณุงูุฉ: "ูุฑุฌู ุงุฎุชูุงุฑ ุงูุดุฑูุฉ ุฃููุงู"
```

### ุณููุงุฑูู 4: ูุณุชุฎุฏู ุนุงุฏู
```
1. ูุณุชุฎุฏู ุงููุฑุน ุงูุดุฑูู ูุณุฌู ุงูุฏุฎูู
2. ูุง ูุฑู ูุงุฆูุฉ ุงุฎุชูุงุฑ ุงูุดุฑูุฉ
3. ูุฑู ููุท ุฃุตูุงู ุงููุฑุน ุงูุดุฑูู
4. ูููุดุฆ ูุญุถุฑ ูููุฑุน ุงูุดุฑูู ููุท
5. โ ูุง ููููู ุงููุตูู ูุดุฑูุงุช ุฃุฎุฑู
```

---

## ๐ ุงูุฃูุงู

### 1. Backend Validation:
```typescript
โ ุงูุชุญูู ูู isSystemUser ูู Backend
โ ุงููุณุชุฎุฏู ุงูุนุงุฏู ูุง ููููู ุชุญุฏูุฏ companyId
โ Admin ููุท ููููู ุชุญุฏูุฏ ุงูุดุฑูุฉ
โ ุงูุชุญูู ูู ูุฌูุฏ ุงูุดุฑูุฉ ูู Database
```

### 2. Frontend Validation:
```typescript
โ ุชุนุทูู ุฒุฑ ุงูุฅูุดุงุก ุญุชู ูุฎุชุงุฑ Admin ุดุฑูุฉ
โ ุฑุณุงูุฉ ุฎุทุฃ ูุงุถุญุฉ
โ ุชุตููุฉ ุงูุฃุตูุงู ุญุณุจ ุงูุดุฑูุฉ ุงููุฎุชุงุฑุฉ
```

### 3. ุนุฒู ุงูุจูุงูุงุช:
```typescript
โ ูู ูุญุถุฑ ูุฑุจูุท ุจุดุฑูุชู ุงูุตุญูุญุฉ
โ ุงูุฎุตู ูู ูุฎุฒูู ุงูุดุฑูุฉ ุงูุตุญูุญุฉ
โ ูุง ูููู ุงูุชูุงุนุจ ุจุงูุดุฑูุฉ ูู Frontend
```

---

## โ ุงูููุงุฆุฏ

- ๐ฏ **ูุฑููุฉ ูุงููุฉ:** Admin ูุนูู ุนูู ุฌููุน ุงูุดุฑูุงุช
- ๐ **ุญุฑูุฉ ุงูุงุฎุชูุงุฑ:** ููุณ ูููุฏุงู ุจุดุฑูุชู
- ๐ **ุจุญุซ ุดุงูู:** ูุจุญุซ ูู ุฃุตูุงู ุฃู ุดุฑูุฉ
- ๐ **ุฃูุงู:** ุงููุณุชุฎุฏู ุงูุนุงุฏู ูุญูู
- โก **ุณุฑุนุฉ:** ุชุจุฏูู ุณุฑูุน ุจูู ุงูุดุฑูุงุช

---

## ๐ ููุงุญุธุงุช ูููุฉ

### โ ูุง ูุนูู ุงูุขู:
1. Admin ูุฎุชุงุฑ ุฃู ุดุฑูุฉ
2. ูุจุญุซ ุนู ุฃุตูุงู ุชูู ุงูุดุฑูุฉ
3. ูููุดุฆ ูุญุถุฑ ูุชูู ุงูุดุฑูุฉ
4. ุงูุฎุตู ูู ูุฎุฒูู ุงูุดุฑูุฉ ุงูุตุญูุญุฉ
5. ุฑูู ุงููุญุถุฑ ุจููุฏ ุงูุดุฑูุฉ ุงูุตุญูุญ

### โ๏ธ ูููุฏ:
1. Admin ูุฌุจ ุฃู ูุฎุชุงุฑ ุดุฑูุฉ ูุญุฏุฏุฉ (ูุง ูููู "ุฌููุน ุงูุดุฑูุงุช")
2. ุงููุณุชุฎุฏู ุงูุนุงุฏู ูุง ููููู ุชุญุฏูุฏ ุงูุดุฑูุฉ
3. Backend ูุชุญูู ูู ุงูุตูุงุญูุงุช

---

## ๐ ุฌุงูุฒ ููุงุณุชุฎุฏุงู!

ุงููุธุงู ุงูุขู ูุฏุนู Admin ุจุดูู ูุงูู:
- โ ุฅูุดุงุก ูุญุงุถุฑ ูุฃู ุดุฑูุฉ
- โ ุงูุจุญุซ ุนู ุฃุตูุงู ุฃู ุดุฑูุฉ
- โ ุงูุชุจุฏูู ุงูุณุฑูุน ุจูู ุงูุดุฑูุงุช
- โ ุฃูุงู ูุนุฒู ูุงูู

**๐ Admin ุงูุขู ุญุฑ ุชูุงูุงู ูู ุงูุนูู ุนูู ุฌููุน ุงูุดุฑูุงุช!**
