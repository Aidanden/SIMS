# ุฏููู ูุธุงู ุงููุจูุนุงุช ุงูุขุฌูุฉ ูุงูุณุฏุงุฏ ุจุงูุฏูุนุงุช

## ูุธุฑุฉ ุนุงูุฉ
ุชู ุฅูุดุงุก ูุธุงู ูุงูู ูุฅุฏุงุฑุฉ ุงููุจูุนุงุช ุงูุขุฌูุฉ ูุน ุฅููุงููุฉ ุงูุณุฏุงุฏ ุจุงูุฏูุนุงุช ูุฅุตุฏุงุฑ ุฅูุตุงูุงุช ูุจุถ ููู ุฏูุนุฉ.

---

## ๐ ุงููููุงุช ุงูููุดุฃุฉ

### ุงูุจุงู ุฅูุฏ (Backend)

#### 1. Schema Database
**ุงูููู:** `server/prisma/schema.prisma`

**ุงูุชุนุฏููุงุช:**
- ุฅุถุงูุฉ ุญููู ุฌุฏูุฏุฉ ูุฌุฏูู `Sale`:
  - `paidAmount`: ุงููุจูุบ ุงููุฏููุน
  - `remainingAmount`: ุงููุจูุบ ุงููุชุจูู
  - `isFullyPaid`: ูู ุชู ุงูุณุฏุงุฏ ุจุงููุงูู
  - `paymentMethod`: ุงุฎุชูุงุฑู ุงูุขู (ููุจูุน ุงูุขุฌู)
  - `payments`: ุนูุงูุฉ ูุน ุฌุฏูู ุงูุฏูุนุงุช

- ุฅุถุงูุฉ ุฌุฏูู ุฌุฏูุฏ `SalePayment`:
  - `id`: ูุนุฑู ุงูุฏูุนุฉ
  - `saleId`: ูุนุฑู ุงููุงุชูุฑุฉ
  - `companyId`: ูุนุฑู ุงูุดุฑูุฉ
  - `receiptNumber`: ุฑูู ุฅูุตุงู ุงููุจุถ (ูุชู ุชูููุฏู ุชููุงุฆูุงู)
  - `amount`: ูุจูุบ ุงูุฏูุนุฉ
  - `paymentMethod`: ุทุฑููุฉ ุงูุฏูุน (ูุงุดุ ุญูุงูุฉุ ุจุทุงูุฉ)
  - `paymentDate`: ุชุงุฑูุฎ ุงูุฏูุน
  - `notes`: ููุงุญุธุงุช
  - `createdAt`: ุชุงุฑูุฎ ุงูุฅูุดุงุก

#### 2. DTOs
**ุงูููู:** `server/src/dto/salePaymentDto.ts`

**ุงููุญุชูู:**
- `CreateSalePaymentDto`: ูุฅูุดุงุก ุฏูุนุฉ ุฌุฏูุฏุฉ
- `GetSalePaymentsQueryDto`: ูุฌูุจ ุงูุฏูุนุงุช ูุน ููุชุฑุฉ
- `GetCreditSalesQueryDto`: ูุฌูุจ ุงููุจูุนุงุช ุงูุขุฌูุฉ ูุน ููุชุฑุฉ
- Zod validation schemas ูุฌููุน DTOs

#### 3. Service
**ุงูููู:** `server/src/services/SalePaymentService.ts`

**ุงููุธุงุฆู:**
- `getCreditSales()`: ุฌูุจ ุฌููุน ุงููุจูุนุงุช ุงูุขุฌูุฉ ูุน pagination ูููุชุฑุฉ
- `getCreditSaleById()`: ุฌูุจ ูุงุชูุฑุฉ ุขุฌูุฉ ูุงุญุฏุฉ ูุน ุชูุงุตูู ุงูุฏูุนุงุช
- `createPayment()`: ุฅูุดุงุก ุฏูุนุฉ ุฌุฏูุฏุฉ ูุน:
  - ุงูุชุญูู ูู ุงููุจูุบ ุงููุชุจูู
  - ุชูููุฏ ุฑูู ุฅูุตุงู ูุจุถ ุชููุงุฆูุงู
  - ุชุญุฏูุซ ุงููุจุงูุบ ูู ุงููุงุชูุฑุฉ
- `getSalePayments()`: ุฌูุจ ุฏูุนุงุช ูุงุชูุฑุฉ ูุนููุฉ
- `deletePayment()`: ุญุฐู ุฏูุนุฉ ูุฅุฑุฌุงุน ุงููุจูุบ ูููุงุชูุฑุฉ
- `getCreditSalesStats()`: ุฅุญุตุงุฆูุงุช ุงููุจูุนุงุช ุงูุขุฌูุฉ
- `generateReceiptNumber()`: ุชูููุฏ ุฑูู ุฅูุตุงู ูุจุถ ุจุตูุบุฉ `REC-YYYYMM-0001`

#### 4. Controller
**ุงูููู:** `server/src/controllers/SalePaymentController.ts`

**ุงูู Endpoints:**
- `GET /api/sale-payments/credit-sales`: ุฌูุจ ุงููุจูุนุงุช ุงูุขุฌูุฉ
- `GET /api/sale-payments/credit-sales/stats`: ุฅุญุตุงุฆูุงุช ุงููุจูุนุงุช ุงูุขุฌูุฉ
- `GET /api/sale-payments/credit-sales/:id`: ุฌูุจ ูุงุชูุฑุฉ ุขุฌูุฉ ูุงุญุฏุฉ
- `GET /api/sale-payments/payments`: ุฌูุจ ุงูุฏูุนุงุช
- `POST /api/sale-payments/payments`: ุฅูุดุงุก ุฏูุนุฉ ุฌุฏูุฏุฉ
- `DELETE /api/sale-payments/payments/:id`: ุญุฐู ุฏูุนุฉ

#### 5. Routes
**ุงูููู:** `server/src/routes/salePaymentRoutes.ts`
- ุชู ุฅุถุงูุฉ ุฌููุน ุงููุณุงุฑุงุช ูุน middleware ุงููุตุงุฏูุฉ

#### 6. ุชุญุฏูุซ index.ts
**ุงูููู:** `server/src/index.ts`
- ุฅุถุงูุฉ `salePaymentRoutes` ุฅูู ุงููุณุงุฑุงุช ุงูุฑุฆูุณูุฉ

---

### ุงููุฑููุช ุฅูุฏ (Frontend)

#### 1. API
**ุงูููู:** `client/src/state/salePaymentApi.ts`

**ุงููุญุชูู:**
- Types ุดุงููุฉ: `CreditSale`, `SalePayment`, `CreatePaymentRequest`
- RTK Query endpoints ูุฌููุน ุงูุนูููุงุช
- Hooks ุฌุงูุฒุฉ ููุงุณุชุฎุฏุงู:
  - `useGetCreditSalesQuery`
  - `useGetCreditSaleByIdQuery`
  - `useGetCreditSalesStatsQuery`
  - `useCreatePaymentMutation`
  - `useGetSalePaymentsQuery`
  - `useDeletePaymentMutation`

#### 2. Redux Store
**ุงูููู:** `client/src/app/redux.tsx`
- ุฅุถุงูุฉ `salePaymentApi` ุฅูู Redux store
- ุฅุถุงูุฉ middleware

#### 3. ุตูุญุฉ ุงููุจูุนุงุช ุงูุขุฌูุฉ
**ุงูููู:** `client/src/app/credit-sales/page.tsx`

**ุงููููุฒุงุช:**
- **ุจุทุงูุงุช ุฅุญุตุงุฆูุฉ:**
  - ุฅุฌูุงูู ุงููุจูุนุงุช ุงูุขุฌูุฉ
  - ุงููุจูุบ ุงูุฅุฌูุงูู
  - ุงููุจูุบ ุงููุฏููุน
  - ุงููุจูุบ ุงููุชุจูู

- **ุฌุฏูู ุงููุจูุนุงุช:**
  - ุนุฑุถ ุฌููุน ุงูููุงุชูุฑ ุงูุขุฌูุฉ
  - ุญุงูุฉ ุงูุณุฏุงุฏ (ูุณุฏุฏุฉุ ูุณุฏุฏุฉ ุฌุฒุฆูุงูุ ุบูุฑ ูุณุฏุฏุฉ)
  - ุฃููุงู ูููุฒุฉ ุญุณุจ ุงูุญุงูุฉ

- **ุงูููุชุฑุฉ ูุงูุจุญุซ:**
  - ุงูุจุญุซ ูู ุฑูู ุงููุงุชูุฑุฉ ุฃู ุงุณู ุงูุนููู
  - ููุชุฑุฉ ุญุณุจ ุญุงูุฉ ุงูุณุฏุงุฏ

- **ููุฏุงู ุฅุถุงูุฉ ุฏูุนุฉ:**
  - ุนุฑุถ ุชูุงุตูู ุงููุงุชูุฑุฉ
  - ุฅุฏุฎุงู ูุจูุบ ุงูุฏูุนุฉ
  - ุงุฎุชูุงุฑ ุทุฑููุฉ ุงูุฏูุน
  - ุฅุถุงูุฉ ููุงุญุธุงุช
  - ุงูุชุญูู ูู ุนุฏู ุชุฌุงูุฒ ุงููุจูุบ ุงููุชุจูู

- **ููุฏุงู ุงูุชูุงุตูู:**
  - ุนุฑุถ ูุนูููุงุช ุงููุงุชูุฑุฉ
  - ุณุฌู ุฌููุน ุงูุฏูุนุงุช
  - ุฅููุงููุฉ ุญุฐู ุฏูุนุฉ

---

## ๐ ุฎุทูุงุช ุงูุชุดุบูู

### 1. ุชุดุบูู Migration
```bash
cd server
npx prisma migrate dev --name add_credit_sales_payments
```

ูุฐุง ุณูููู ุจู:
- ุฅุถุงูุฉ ุงูุญููู ุงูุฌุฏูุฏุฉ ูุฌุฏูู `Sale`
- ุฅูุดุงุก ุฌุฏูู `SalePayment`
- ุชุญุฏูุซ Prisma Client

### 2. ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุงุฏู
```bash
cd server
npm run dev
```

### 3. ุฅุนุงุฏุฉ ุชุดุบูู ุงููุฑููุช ุฅูุฏ
```bash
cd client
npm run dev
```

### 4. ุงููุตูู ููุตูุญุฉ
ุงูุชุญ ุงููุชุตูุญ ูุงูุชูู ุฅูู:
```
http://localhost:3030/credit-sales
```

---

## ๐ก ููููุฉ ุงูุงุณุชุฎุฏุงู

### 1. ุนุฑุถ ุงููุจูุนุงุช ุงูุขุฌูุฉ
- ุงูุชุญ ุตูุญุฉ ุงููุจูุนุงุช ุงูุขุฌูุฉ
- ุณุชุธูุฑ ุฌููุน ุงูููุงุชูุฑ ุงูุขุฌูุฉ ูุน ุญุงูุฉ ุงูุณุฏุงุฏ

### 2. ุฅุถุงูุฉ ุฏูุนุฉ ุฌุฏูุฏุฉ
1. ุงุถุบุท ุนูู ุฃููููุฉ ๐ฐ ุจุฌุงูุจ ุงููุงุชูุฑุฉ
2. ุฃุฏุฎู ูุจูุบ ุงูุฏูุนุฉ (ูุง ูููู ุฃู ูุชุฌุงูุฒ ุงููุจูุบ ุงููุชุจูู)
3. ุงุฎุชุฑ ุทุฑููุฉ ุงูุฏูุน (ูุงุดุ ุญูุงูุฉุ ุจุทุงูุฉ)
4. ุฃุถู ููุงุญุธุงุช ุฅุฐุง ูุฒู ุงูุฃูุฑ
5. ุงุถุบุท "ุญูุธ ุงูุฏูุนุฉ"

### 3. ุนุฑุถ ุชูุงุตูู ุงููุงุชูุฑุฉ
1. ุงุถุบุท ุนูู ุฃููููุฉ ๐๏ธ ุจุฌุงูุจ ุงููุงุชูุฑุฉ
2. ุณุชุธูุฑ ุฌููุน ุชูุงุตูู ุงููุงุชูุฑุฉ
3. ุณุฌู ุงูุฏูุนุงุช ูุน ุฅููุงููุฉ ุญุฐู ุฃู ุฏูุนุฉ

### 4. ุญุฐู ุฏูุนุฉ
1. ุงูุชุญ ุชูุงุตูู ุงููุงุชูุฑุฉ
2. ุงุถุบุท ุนูู ุฃููููุฉ ๐๏ธ ุจุฌุงูุจ ุงูุฏูุนุฉ
3. ุฃูุฏ ุงูุญุฐู
4. ุณูุชู ุฅุฑุฌุงุน ุงููุจูุบ ูููุงุชูุฑุฉ ุชููุงุฆูุงู

---

## ๐ ุงูุฅุญุตุงุฆูุงุช ุงููุชููุฑุฉ

### ุงูุจุทุงูุงุช ุงูุฅุญุตุงุฆูุฉ
- **ุฅุฌูุงูู ุงููุจูุนุงุช ุงูุขุฌูุฉ**: ุนุฏุฏ ุฌููุน ุงูููุงุชูุฑ ุงูุขุฌูุฉ
- **ุงููุจูุบ ุงูุฅุฌูุงูู**: ูุฌููุน ูููุฉ ุฌููุน ุงูููุงุชูุฑ
- **ุงููุจูุบ ุงููุฏููุน**: ูุฌููุน ุงููุจุงูุบ ุงููุฏููุนุฉ
- **ุงููุจูุบ ุงููุชุจูู**: ูุฌููุน ุงููุจุงูุบ ุงููุชุจููุฉ

### ุญุงูุงุช ุงูุณุฏุงุฏ
- **ูุณุฏุฏุฉ**: ุชู ุณุฏุงุฏ ุงููุจูุบ ุจุงููุงูู (ุฃุฎุถุฑ)
- **ูุณุฏุฏุฉ ุฌุฒุฆูุงู**: ุชู ุณุฏุงุฏ ุฌุฒุก ูู ุงููุจูุบ (ุฃุตูุฑ)
- **ุบูุฑ ูุณุฏุฏุฉ**: ูู ูุชู ุงูุณุฏุงุฏ (ุฃุญูุฑ)

---

## ๐ ุงูุฃูุงู ูุงูุตูุงุญูุงุช

### ุนุฒู ุงูุจูุงูุงุช
- ูู ุดุฑูุฉ ุชุฑู ููุท ูุจูุนุงุชูุง ุงูุขุฌูุฉ ูุฏูุนุงุชูุง
- ุงููุณุชุฎุฏููู ุงูุนุงุฏููู: ูุฑูู ููุท ุจูุงูุงุช ุดุฑูุชูู
- ูุณุชุฎุฏูู ุงููุธุงู (`isSystemUser: true`): ูููููู ุฑุคูุฉ ุฌููุน ุงูุจูุงูุงุช

### ุงูุชุญูู ูู ุงูุตุญุฉ
- ุงูุชุญูู ูู ุงููุจูุบ ุงููุฏููุน ูุง ูุชุฌุงูุฒ ุงููุจูุบ ุงููุชุจูู
- ุงูุชุญูู ูู ุตูุงุญูุฉ ุงููุตูู ูููุงุชูุฑุฉ
- ุงูุชุญูู ูู ุนุฏู ุงูุณุฏุงุฏ ููุงุชูุฑุฉ ูุณุฏุฏุฉ ุจุงููุงูู

---

## ๐จ ุงูุชุตููู ูุงููุงุฌูุฉ

### ุงูุฃููุงู
- **ุฃุฎุถุฑ**: ุงููุจุงูุบ ุงููุฏููุนุฉุ ุงูููุงุชูุฑ ุงููุณุฏุฏุฉ
- **ุฃุญูุฑ**: ุงููุจุงูุบ ุงููุชุจููุฉุ ุงูููุงุชูุฑ ุบูุฑ ุงููุณุฏุฏุฉ
- **ุฃุตูุฑ**: ุงูููุงุชูุฑ ุงููุณุฏุฏุฉ ุฌุฒุฆูุงู
- **ุฃุฒุฑู**: ุงูุฃุฒุฑุงุฑ ุงูุฑุฆูุณูุฉ

### ุงูุฃููููุงุช
- ๐ฐ: ุฅุถุงูุฉ ุฏูุนุฉ
- ๐๏ธ: ุนุฑุถ ุงูุชูุงุตูู
- ๐๏ธ: ุญุฐู ุฏูุนุฉ

### ุงูุชูุณูู
- ุงูุฃุฑูุงู ุจุงูุนุฑุจูุฉ: `toLocaleString('ar-LY')`
- ุงูุนููุฉ: ุฏ.ู (ุฏููุงุฑ ููุจู)
- ุงูุชูุงุฑูุฎ ุจุงูุนุฑุจูุฉ

---

## ๐ ููุงุญุธุงุช ูููุฉ

### ุฑูู ุฅูุตุงู ุงููุจุถ
- ูุชู ุชูููุฏู ุชููุงุฆูุงู ุจุตูุบุฉ: `REC-YYYYMM-0001`
- ูุซุงู: `REC-202510-0001` (ุฃูู ุฅูุตุงู ูู ุฃูุชูุจุฑ 2025)
- ูุฒุฏุงุฏ ุงูุฑูู ุชููุงุฆูุงู ููู ุฅูุตุงู ุฌุฏูุฏ

### ุชุญุฏูุซ ุงููุจุงูุบ
- ุนูุฏ ุฅุถุงูุฉ ุฏูุนุฉ:
  - ูุฒุฏุงุฏ `paidAmount`
  - ูููุต `remainingAmount`
  - ูุชู ุชุญุฏูุซ `isFullyPaid` ุฅุฐุง ุชู ุงูุณุฏุงุฏ ุจุงููุงูู

- ุนูุฏ ุญุฐู ุฏูุนุฉ:
  - ูููุต `paidAmount`
  - ูุฒุฏุงุฏ `remainingAmount`
  - ูุชู ุชุญุฏูุซ `isFullyPaid` ุฅูู `false`

### ุงูููุชุฑุฉ
- ูููู ุงูุจุญุซ ูู ุฑูู ุงููุงุชูุฑุฉ ุฃู ุงุณู ุงูุนููู
- ูููู ููุชุฑุฉ ุงูููุงุชูุฑ ุญุณุจ ุญุงูุฉ ุงูุณุฏุงุฏ
- ูููู ููุชุฑุฉ ุญุณุจ ุงูุชุงุฑูุฎ (ูู API)

---

## ๐ง ุงูุชุทููุฑุงุช ุงููุณุชูุจููุฉ ุงูููุชุฑุญุฉ

1. **ุทุจุงุนุฉ ุฅูุตุงู ุงููุจุถ**: ุฅุถุงูุฉ ุฅููุงููุฉ ุทุจุงุนุฉ ุฅูุตุงู ููู ุฏูุนุฉ
2. **ุชูุงุฑูุฑ ููุตูุฉ**: ุชูุงุฑูุฑ ุนู ุงูุฏูุนุงุช ุญุณุจ ุงููุชุฑุฉ ุงูุฒูููุฉ
3. **ุชูุจููุงุช**: ุชูุจููุงุช ููููุงุชูุฑ ุงููุชุฃุฎุฑุฉ
4. **ุฌุฏููุฉ ุงูุฏูุนุงุช**: ุฅููุงููุฉ ุฌุฏููุฉ ุฏูุนุงุช ูุณุชูุจููุฉ
5. **ุชุตุฏูุฑ ุงูุจูุงูุงุช**: ุชุตุฏูุฑ ุงููุจูุนุงุช ุงูุขุฌูุฉ ุฅูู Excel/PDF

---

## โ ุงูุฎูุงุตุฉ

ุชู ุฅูุดุงุก ูุธุงู ูุงูู ููุชูุงูู ูุฅุฏุงุฑุฉ ุงููุจูุนุงุช ุงูุขุฌูุฉ ูุน:
- โ ูุงุนุฏุฉ ุจูุงูุงุช ูุญุฏุซุฉ ูุน ุฌุฏุงูู ุฌุฏูุฏุฉ
- โ ุจุงู ุฅูุฏ ูุงูู ูุน ุฌููุน ุงูุนูููุงุช
- โ ูุฑููุช ุฅูุฏ ุฌููู ููุชุฌุงูุจ
- โ ูุธุงู ุฏูุนุงุช ูุชุนุฏุฏ ูุน ุฅูุตุงูุงุช ูุจุถ
- โ ุฅุญุตุงุฆูุงุช ุดุงููุฉ
- โ ุฃูุงู ูุนุฒู ูุงูู ุจูู ุงูุดุฑูุงุช
- โ ูุงุฌูุฉ ุนุฑุจูุฉ ุจุงููุงูู

ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุงูููุฑู! ๐
