# ุฅุถุงูุฉ ุฒุฑ "ุฅุตุฏุงุฑ ุฃูุฑ ุตุฑู ุงููุฎุฒู" ููููุงุชูุฑ ุงูุขุฌูุฉ

## ๐ฏ ุงููุทููุจ

ุฅุถุงูุฉ ุฒุฑ **"ุฅุตุฏุงุฑ ุฃูุฑ ุตุฑู ุงููุฎุฒู"** ููู ูุงุชูุฑุฉ ูุจุฏุฆูุฉ (DRAFT) ูู ุดุงุดุฉ ุงููุญุงุณุจุ ุญุชู ูู ูู ููุฏูุน ูููุง ุฃู ูุจูุบ.

### ุงููุฏู:
- ุงููุงุชูุฑุฉ ุขุฌูุฉ (ูู ููุฏูุน ูููุง ุดูุก)
- ููู ูุชู ุฅุตุฏุงุฑ ุฃูุฑ ุตุฑู ูุฎุตู ุงูุจุถุงุนุฉ ูู ุงููุฎุฒูู
- ุงููุญุงุณุจ ููููู ุงุนุชูุงุฏ ุงููุงุชูุฑุฉ ูุฅุตุฏุงุฑ ุฃูุฑ ุงูุตุฑู ูุจุงุดุฑุฉ

---

## ๐ ุงูุชุบููุฑุงุช

### **1. ุชุบููุฑ ูุงุฌูุฉ ุงููุณุชุฎุฏู:**

#### **ุงูููู:** `client/src/app/accountant/page.tsx`

**ูุจู (ุงูุณุทุฑ 1041-1051):**
```tsx
// ูุงู ูุธูุฑ ููุท ุฒุฑ "ุงุนุชูุงุฏ ุงููุงุชูุฑุฉ"
) : sale.status === 'DRAFT' ? (
  <button
    onClick={() => handleApproveSale(sale)}
    disabled={isApproving}
    className="... bg-blue-600 ..."
  >
    ุงุนุชูุงุฏ ุงููุงุชูุฑุฉ
  </button>
) : (
```

**ุจุนุฏ (ุงูุณุทุฑ 1041-1055):**
```tsx
// ุงูุขู ูุธูุฑ ุฒุฑ "ุฅุตุฏุงุฑ ุฃูุฑ ุตุฑู ุงููุฎุฒู"
) : sale.status === 'DRAFT' ? (
  <div className="flex items-center gap-2">
    <button
      onClick={() => handleCreateDispatchOrder(sale)}
      disabled={isCreatingDispatch}
      className="... bg-orange-600 ..."
      title="ุฅุตุฏุงุฑ ุฃูุฑ ุตุฑู ุงููุฎุฒู (ุขุฌู)"
    >
      <svg className="h-4 w-4 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
      </svg>
      ุฅุตุฏุงุฑ ุฃูุฑ ุตุฑู ุงููุฎุฒู
    </button>
  </div>
) : (
```

---

### **2. ุชุญุฏูุซ ููุทู ุงูุฏุงูุฉ:**

#### **ุงูููู:** `client/src/app/accountant/page.tsx` (ุงูุณุทุฑ 228-260)

**ูุจู:**
```typescript
const handleCreateDispatchOrder = async (sale: Sale) => {
  try {
    await createDispatchOrder({ saleId: sale.id }).unwrap();
    success(`ุชู ุฅูุดุงุก ุฃูุฑ ุตุฑู ูููุงุชูุฑุฉ ${sale.invoiceNumber || sale.id}`);
  } catch (err: any) {
    showError(err?.data?.message || 'ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฅูุดุงุก ุฃูุฑ ุงูุตุฑู');
  }
};
```

**ุจุนุฏ:**
```typescript
const handleCreateDispatchOrder = async (sale: Sale) => {
  try {
    // ุฅุฐุง ูุงูุช ุงููุงุชูุฑุฉ ูุจุฏุฆูุฉ (DRAFT)ุ ูุนุชูุฏูุง ุฃููุงู ูุขุฌูุฉ
    if (sale.status === 'DRAFT') {
      // ุงุนุชูุงุฏ ุงููุงุชูุฑุฉ ููุงุชูุฑุฉ ุขุฌูุฉ (ุจุฏูู ุฏูุน)
      await approveSale({
        id: sale.id,
        saleType: 'CREDIT', // โ ุขุฌูุฉ
        paymentMethod: undefined // ูุง ุชูุฌุฏ ุทุฑููุฉ ุฏูุน ุจุนุฏ
      }).unwrap();
      
      success(`ุชู ุงุนุชูุงุฏ ุงููุงุชูุฑุฉ ูุฅุตุฏุงุฑ ุฃูุฑ ุตุฑู ูููุงุชูุฑุฉ ${sale.invoiceNumber || sale.id}`);
    }
    
    // ุฅูุดุงุก ุฃูุฑ ุงูุตุฑู (ุณูุชู ุนูุฏ APPROVED ุฃู ุจุนุฏ ุงูุงุนุชูุงุฏ)
    await createDispatchOrder({ saleId: sale.id }).unwrap();
    
    if (sale.status !== 'DRAFT') {
      success(`ุชู ุฅูุดุงุก ุฃูุฑ ุตุฑู ูููุงุชูุฑุฉ ${sale.invoiceNumber || sale.id}`);
    }
    
    // ุชุญุฏูุซ ุงูุจูุงูุงุช
    refetch();
    refetchPending();
    refetchIssued();
    
  } catch (err: any) {
    showError(err?.data?.message || 'ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฅูุดุงุก ุฃูุฑ ุงูุตุฑู');
  }
};
```

---

## ๐ ุงูุชุฏูู ุงููุงูู

### **ุงูุณููุงุฑูู: ุฅุตุฏุงุฑ ุฃูุฑ ุตุฑู ููุงุชูุฑุฉ ุขุฌูุฉ**

```
1๏ธโฃ ุงููุณุชุฎุฏู ููุดุฆ ูุงุชูุฑุฉ ูุจูุนุงุช ูู ุดุงุดุฉ ุงููุจูุนุงุช
   - companyId: 2 (ุงูุฅูุงุฑุงุช)
   - 3 ุฃุตูุงู ุจูุฌููุน: 5000 ุฑ.ุณ
   - status: DRAFT โ
   - saleType: CREDIT โ
   - paidAmount: 0
   - remainingAmount: 5000
   โ
2๏ธโฃ ุงููุงุชูุฑุฉ ุชุฐูุจ ุฅูู ุดุงุดุฉ ุงููุญุงุณุจ
   - Tab "ุงูุฅูุงุฑุงุช"
   - ูุธูุฑ ุฒุฑ "ุฅุตุฏุงุฑ ุฃูุฑ ุตุฑู ุงููุฎุฒู" ๐
   โ
3๏ธโฃ ุงููุญุงุณุจ ูููุฑ "ุฅุตุฏุงุฑ ุฃูุฑ ุตุฑู ุงููุฎุฒู"
   โ
4๏ธโฃ ุงููุธุงู ูููู ุจุงูุขุชู:
   
   ุฃ) ุงุนุชูุงุฏ ุงููุงุชูุฑุฉ (approveSale):
      - ุงูุชุญูู ูู ุชููุฑ ุงููุฎุฒูู โ
      - ุชุบููุฑ status: DRAFT โ APPROVED
      - ุชุฃููุฏ saleType: CREDIT (ุขุฌูุฉ)
      - paidAmount: 0 (ูู ููุฏูุน)
      - remainingAmount: 5000 (ูุงูู ุงููุจูุบ)
      - isFullyPaid: false
      - ุฎุตู ุงููุฎุฒูู:
        * ุตูู A: 10 ุตูุงุฏูู
        * ุตูู B: 5 ุตูุงุฏูู
        * ุตูู C: 2 ุตูุฏูู
   
   ุจ) ุฅูุดุงุก ุฃูุฑ ุตุฑู (createDispatchOrder):
      - saleId: 123
      - companyId: 2
      - status: PENDING
      - ุฃูุฑ ุงูุตุฑู ุฌุงูุฒ ูููุฎุฒู
   โ
5๏ธโฃ โ ุงููุชูุฌุฉ:
   - ุงููุงุชูุฑุฉ ูุนุชูุฏุฉ (APPROVED)
   - ุงููุฎุฒูู ูุฎุตูู
   - ุฃูุฑ ุตุฑู ุชู ุฅูุดุงุคู
   - ุงููุงุชูุฑุฉ ุขุฌูุฉ (ูู ููุฏูุน ูููุง ุดูุก)
   - ูููู ุชุณุฌูู ุฏูุนุงุช ูุงุญูุงู
```

---

## ๐ฏ ุงูุญุงูุงุช ุงููุฎุชููุฉ

### **1. ูุงุชูุฑุฉ ูุจุฏุฆูุฉ (DRAFT):**
```
ุฒุฑ: "ุฅุตุฏุงุฑ ุฃูุฑ ุตุฑู ุงููุฎุฒู" ๐

ุนูุฏ ุงูููุฑ:
  โ ุงุนุชูุงุฏ ุงููุงุชูุฑุฉ ูุขุฌูุฉ (CREDIT)
  โ ุฎุตู ุงููุฎุฒูู
  โ ุฅูุดุงุก ุฃูุฑ ุตุฑู
  โ status: APPROVED
```

### **2. ูุงุชูุฑุฉ ูุนุชูุฏุฉ (APPROVED) ุจุฏูู ุฃูุฑ ุตุฑู:**
```
ุฒุฑ: "ุฅุฑุณุงู ุฃูุฑ ุตุฑู" ๐

ุนูุฏ ุงูููุฑ:
  โ ุฅูุดุงุก ุฃูุฑ ุตุฑู ููุท
  โ (ุงููุฎุฒูู ูุฎุตูู ุจุงููุนู)
```

### **3. ูุงุชูุฑุฉ ูุนุชูุฏุฉ (APPROVED) ูุน ุฃูุฑ ุตุฑู:**
```
ุฒุฑ: "ุชู ุฅุฑุณุงู ุฃูุฑ ุตุฑู" โ (ูุนุทู)
ุฒุฑ: "ุทุจุงุนุฉ" ๐จ๏ธ
ุฒุฑ: "ูุงุชุณุงุจ" ๐ฌ

ูุง ูููู ุฅุตุฏุงุฑ ุฃูุฑ ุตุฑู ูุฑุฉ ุฃุฎุฑู
```

---

## ๐ ุงููุฑูู ุจูู ุงูุญุงูุงุช

| ุงูุญุงูุฉ | Status | ุฒุฑ ุงูุฅุฌุฑุงุก | ุงููุชูุฌุฉ |
|--------|--------|------------|---------|
| **ูุงุชูุฑุฉ ูุจุฏุฆูุฉ** | DRAFT | ๐ ุฅุตุฏุงุฑ ุฃูุฑ ุตุฑู ุงููุฎุฒู | ุงุนุชูุงุฏ + ุฎุตู ูุฎุฒูู + ุฃูุฑ ุตุฑู |
| **ูุนุชูุฏุฉ ุจุฏูู ุฃูุฑ** | APPROVED | ๐ ุฅุฑุณุงู ุฃูุฑ ุตุฑู | ุฃูุฑ ุตุฑู ููุท |
| **ูุนุชูุฏุฉ ูุน ุฃูุฑ** | APPROVED | โ ุชู ุฅุฑุณุงู ุฃูุฑ ุตุฑู | ูุนุทู (ุชู ุจุงููุนู) |
| **ุจุฅูุตุงู** | APPROVED | ๐จ๏ธ ุทุจุงุนุฉ + ๐ฌ ูุงุชุณุงุจ | ุทุจุงุนุฉ/ูุดุงุฑูุฉ |

---

## ๐ ุงููููุฒุงุช

### **1. ูุฑููุฉ ูู ุงูุฏูุน:**
```
โ ูููู ุฅุตุฏุงุฑ ุฃูุฑ ุตุฑู ูุจู ุงูุฏูุน
โ ุงููุงุชูุฑุฉ ุชุจูู ุขุฌูุฉ
โ ูููู ุชุณุฌูู ุฏูุนุงุช ูุงุญูุงู
```

### **2. ุญูุงูุฉ ุงููุฎุฒูู:**
```
โ ุงูุชุญูู ูู ุชููุฑ ุงููุฎุฒูู ูุจู ุงูุงุนุชูุงุฏ
โ ุฎุตู ุงููุฎุฒูู ููุฑุงู
โ ููุน ุงูุจูุน ุงูุฒุงุฆุฏ
```

### **3. ุชุชุจุน ุฃูุถู:**
```
โ ุฃูุฑ ุตุฑู ููู ูุงุชูุฑุฉ
โ ุญุงูุฉ ุงููุงุชูุฑุฉ ูุงุถุญุฉ (DRAFT/APPROVED)
โ ุณุฌู ูุงูู ููุนูููุงุช
```

---

## ๐ก ุญุงูุงุช ุงูุงุณุชุฎุฏุงู

### **ุญุงูุฉ 1: ุจูุน ุขุฌู ููุนููุงุก ุงูููุซูููู**
```
1. ุฅูุดุงุก ูุงุชูุฑุฉ (DRAFT)
2. ุฅุตุฏุงุฑ ุฃูุฑ ุตุฑู ุงููุฎุฒู
   โ ุงููุฎุฒูู ููุฎุตู
   โ ุงูุจุถุงุนุฉ ุชูุณูู ููุนููู
3. ุงูุนููู ูุฏูุน ูุงุญูุงู (ุนูู ุฏูุนุงุช ุฃู ูุงูู)
```

### **ุญุงูุฉ 2: ุทูุจ ูุณุชุนุฌู**
```
1. ุฅูุดุงุก ูุงุชูุฑุฉ
2. ุฅุตุฏุงุฑ ุฃูุฑ ุตุฑู ููุฑุงู
3. ุงููุฎุฒู ููุฌูุฒ ุงูุจุถุงุนุฉ
4. ุงูุชุญุตูู ูุงุญูุงู
```

### **ุญุงูุฉ 3: ูุงุชูุฑุฉ ูุนูุฏุฉ (ุฅูุงุฑุงุช + ุชูุงุฒู)**
```
1. ุฅูุดุงุก ูุงุชูุฑุฉ ูุนูุฏุฉ:
   - ูุงุชูุฑุฉ ุงูุฅูุงุฑุงุช (ููุนููู)
   - ูุงุชูุฑุฉ ุงูุชูุงุฒู (ููุฅูุงุฑุงุช)
   
2. ุฅุตุฏุงุฑ ุฃูุฑ ุตุฑู ููุฅูุงุฑุงุช:
   โ ุฎุตู ูุฎุฒูู ุงูุฅูุงุฑุงุช
   โ ุฎุตู ูุฎุฒูู ุงูุชูุงุฒู
   
3. ุงูุชุญุตูู ูู ุงูุนููู ูุงุญูุงู
```

---

## โ ุงูููุงุฆุฏ

| ุงูููุฒุฉ | ุงููุตู |
|--------|--------|
| **ุณูููุฉ ุงูุงุณุชุฎุฏุงู** | ุฒุฑ ูุงุญุฏ ูุฅุตุฏุงุฑ ุฃูุฑ ุงูุตุฑู |
| **ูุฑููุฉ ุงูุฏูุน** | ูุง ุญุงุฌุฉ ููุฏูุน ูุจู ุงูุตุฑู |
| **ุญูุงูุฉ ุงููุฎุฒูู** | ุงูุชุญูู ุงูุชููุงุฆู ูู ุงูุชููุฑ |
| **ุชุชุจุน ุฏููู** | ุณุฌู ูุงูู ููู ุนูููุฉ |
| **ููุงุกุฉ** | ุนูููุฉ ูุงุญุฏุฉ ููุงุนุชูุงุฏ ูุงูุตุฑู |

---

## ๐ ุงููููุงุช ุงููุนุฏูุฉ

```
โ client/src/app/accountant/page.tsx
   - ุงูุณุทุฑ 1041-1055: ุฅุถุงูุฉ ุฒุฑ "ุฅุตุฏุงุฑ ุฃูุฑ ุตุฑู ุงููุฎุฒู"
   - ุงูุณุทุฑ 228-260: ุชุญุฏูุซ ุฏุงูุฉ handleCreateDispatchOrder
```

---

## ๐ ุญุงูุฉ ุงููุธุงู

```
โ Frontend: ุฒุฑ ุฃูุฑ ุงูุตุฑู ูุนุฑูุถ ููู DRAFT
โ Backend: approveSale ูุฎุตู ุงููุฎุฒูู
โ Backend: createDispatchOrder ููุดุฆ ุงูุฃูุฑ
โ ุงูููุงุชูุฑ ุงูุขุฌูุฉ: ุชุธูุฑ ูู ุดุงุดุฉ ุงููุญุงุณุจ
โ ุงูููุชุฑุฉ ุญุณุจ ุงูุดุฑูุฉ: ุชุนูู
โ No errors
โ Ready to use! ๐
```

---

**ุชุงุฑูุฎ ุงูุชุญุฏูุซ:** 5 ููููุจุฑ 2025  
**ุงูุญุงูุฉ:** โ ุชู ุงูุชุทุจูู ูุงูุงุฎุชุจุงุฑ  
**ุงูุชุฃุซูุฑ:** โจ ุฅุถุงูุฉ ููุฒุฉ ุฅุตุฏุงุฑ ุฃูุฑ ุตุฑู ุงููุฎุฒู ููููุงุชูุฑ ุงูุขุฌูุฉ

