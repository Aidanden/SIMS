# عرض الدفعات الجزئية في تفاصيل الإيصال

## المشكلة السابقة
في قسم "الدفعات المنجزة" بتفاصيل الإيصال، كان يعرض:
- إذا كان الإيصال مسدد بالكامل: "دفعة كاملة" مع المبلغ الكلي فقط
- إذا كان مدفوع جزئياً: رسالة "لعرض تفاصيل الدفعات الجزئية، يرجى النقر على زر 'دفعات جزئية'"

## الحل المطبق

### ✅ عرض كل دفعة جزئية على حدة:
الآن يعرض القسم:
1. **جميع الدفعات الجزئية** المنجزة مع تفاصيل كل دفعة:
   - المبلغ المدفوع
   - تاريخ الدفع
   - طريقة الدفع (إن وجدت)
   - الرقم المرجعي (إن وجد)
   - الملاحظات (إن وجدت)
   - زر طباعة لكل دفعة

2. **إذا لم تكن هناك دفعات جزئية** ولكن الإيصال مسدد:
   - يعرض "دفعة كاملة" مع تاريخ التسديد

3. **إذا لم تكن هناك دفعات منجزة**:
   - يعرض رسالة "لا توجد دفعات منجزة لهذا الإيصال"

## كيفية عمل النظام الجديد

### 1. جلب البيانات:
```typescript
const { data: installmentsData } = useGetInstallmentsByReceiptIdQuery(
  selectedReceipt?.id || 0,
  { skip: !selectedReceipt?.id || (!showInstallmentsModal && !showDetailsModal) }
);
```
- يجلب الدفعات عند فتح مودال التفاصيل أو مودال الدفعات

### 2. عرض الدفعات:
```typescript
{installmentsData?.installments && installmentsData.installments.length > 0 ? (
  // عرض كل دفعة جزئية مع تفاصيلها
  installmentsData.installments.map((installment) => (
    // عرض تفاصيل الدفعة + زر طباعة
  ))
) : selectedReceipt.status === 'PAID' ? (
  // عرض الدفعة الكاملة
) : (
  // رسالة عدم وجود دفعات
)}
```

## النتيجة

✅ **عرض شامل لجميع الدفعات** - كل دفعة جزئية تظهر على حدة مع تفاصيلها  
✅ **تجربة مستخدم محسنة** - لا حاجة لفتح مودال منفصل للدفعات  
✅ **طباعة فردية لكل دفعة** - زر طباعة لكل دفعة جزئية  
✅ **معلومات مفصلة** - تاريخ، طريقة دفع، رقم مرجعي، ملاحظات

## اختبار النظام

### اختبار 1: إيصال بدفعات جزئية
1. اذهب إلى تفاصيل إيصال مدفوع جزئياً
2. يجب أن ترى قسم "الدفعات المنجزة" مع كل دفعة منفصلة
3. كل دفعة تحتوي على تفاصيلها الكاملة + زر طباعة

### اختبار 2: إيصال مسدد كاملاً
1. اذهب إلى تفاصيل إيصال مسدد بالكامل
2. إذا كان هناك دفعات جزئية مسجلة: تظهر كل دفعة
3. إذا لم يكن هناك دفعات جزئية: يظهر "دفعة كاملة"

### اختبار 3: إيصال بدون دفعات
1. اذهب إلى تفاصيل إيصال معلق أو ملغي
2. يجب أن ترى رسالة "لا توجد دفعات منجزة لهذا الإيصال"

✅ **الآن تفاصيل الإيصال تعرض كل دفعة جزئية على حدة كما طُلب!**
