# ๐ ุฅุตูุงุญ ุงูุจุญุซ ูู ุฌููุน ุงูุฃุตูุงู

## โ ุงููุดููุฉ

ูุง ูููู ุงูุจุญุซ ูู ุฌููุน ุงูุฃุตูุงู - ูุธูุฑ ุฌุฒุก ูู ุงูุฃุตูุงู ููุท ุนูุฏ ุงูุจุญุซ.

---

## ๐ ุงูุฃุณุจุงุจ

### 1๏ธโฃ **ูุดููุฉ Pagination:**
```typescript
โ ุงูู API ูุงู ูุฌูุจ 10 ุฃุตูุงู ููุท (default limit)
โ ุงูุจุญุซ ูุญุฏูุฏ ุจุงูุตูุญุฉ ุงูุฃููู
โ ุจุงูู ุงูุฃุตูุงู ุบูุฑ ูุฑุฆูุฉ
```

### 2๏ธโฃ **ูุดููุฉ Backend Logic:**
```typescript
โ Admin ูุฎุชุงุฑ ุดุฑูุฉ ุงูุฅูุงุฑุงุช โ ูุฑู ุฃุตูุงู ุงูุฅูุงุฑุงุช ููุท
โ ูุง ูุฑู ุฃุตูุงู ุงูุชูุงุฒู (ุงูุดุฑูุฉ ุงูุฃู)
โ ุชุตููุฉ ุบูุฑ ุตุญูุญุฉ
```

### 3๏ธโฃ **ูุดููุฉ Frontend Filtering:**
```typescript
โ ุชุตููุฉ ูุถุงุนูุฉ (Backend + Frontend)
โ ุชุนููุฏ ุบูุฑ ุถุฑูุฑู
โ ุฃุฏุงุก ุจุทูุก
```

---

## โ ุงูุญู ุงูููููุฐ

### 1๏ธโฃ **Backend: ุฅุตูุงุญ ุชุตููุฉ ุงูุดุฑูุงุช**

#### ูุจู ุงูุฅุตูุงุญ:
```typescript
// โ ูุธูุฑ ุดุฑูุฉ ูุงุญุฏุฉ ููุท
if (companyId) {
  whereConditions.createdByCompanyId = companyId;
}
```

#### ุจุนุฏ ุงูุฅุตูุงุญ:
```typescript
// โ ูุธูุฑ ุงูุดุฑูุฉ ุงููุฎุชุงุฑุฉ + ุงูุชูุงุฒู
if (companyId === 1) {
  companyConditions = [{ createdByCompanyId: 1 }];
} else {
  companyConditions = [
    { createdByCompanyId: companyId },    // ุงูุดุฑูุฉ ุงููุฎุชุงุฑุฉ
    { createdByCompanyId: 1 }            // ุงูุชูุงุฒู (ุงูุดุฑูุฉ ุงูุฃู)
  ];
}
```

### 2๏ธโฃ **Backend: ุฅุตูุงุญ ุฏูุฌ ุดุฑูุท ุงูุจุญุซ**

#### ุงููุดููุฉ:
```typescript
โ whereConditions.OR ูุณุชุฎุฏู ูุฑุชูู
โ ุชุถุงุฑุจ ุจูู ุดุฑูุท ุงูุดุฑูุฉ ูุงูุจุญุซ
```

#### ุงูุญู:
```typescript
โ ูุตู ุดุฑูุท ุงูุดุฑูุฉ ุนู ุดุฑูุท ุงูุจุญุซ
โ ุฏูุฌููุง ุจุงุณุชุฎุฏุงู AND
whereConditions.AND = [
  { OR: companyConditions },    // ุดุฑูุท ุงูุดุฑูุฉ
  { OR: searchConditions }      // ุดุฑูุท ุงูุจุญุซ
];
```

### 3๏ธโฃ **Frontend: ุงูุจุญุซ ุงููุจุงุดุฑ ูู API**

#### ูุจู ุงูุฅุตูุงุญ:
```typescript
โ ุฌูุจ ุฌููุน ุงูุฃุตูุงู ุซู ุงูุชุตููุฉ ูู Frontend
โ ุจุทุก ูุฅูุฏุงุฑ ููููุงุฑุฏ
const { data: productsData } = useGetProductsQuery({
  companyId: selectedCompanyId,
  limit: 1000, // ุนุฏุฏ ูุจูุฑ
});
```

#### ุจุนุฏ ุงูุฅุตูุงุญ:
```typescript
โ ุงูุจุญุซ ุงููุจุงุดุฑ ูู Backend
โ ุฌูุจ ุงููุชุงุฆุฌ ุงููุทููุจุฉ ููุท
const { data: productsData } = useGetProductsQuery({
  companyId: selectedCompanyId,
  search: productSearchTerm,     // ุงูุจุญุซ ุงููุจุงุดุฑ
  limit: 50,                     // ุนุฏุฏ ูุนููู
}, {
  skip: !productSearchTerm,      // ูุง ูุฌูุจ ุฅูุง ุนูุฏ ุงูุจุญุซ
});
```

### 4๏ธโฃ **Frontend: ุชุจุณูุท ุงูุชุตููุฉ**

#### ูุจู ุงูุฅุตูุงุญ:
```typescript
โ ุชุตููุฉ ูุนูุฏุฉ ูู Frontend
const filteredProducts = products.filter((product) => {
  // ููุทู ูุนูุฏ ููุชุตููุฉ
  const isFromTargetCompany = ...;
  const isFromParentCompany = ...;
  return isFromTargetCompany || isFromParentCompany;
});
```

#### ุจุนุฏ ุงูุฅุตูุงุญ:
```typescript
โ Backend ูุชุนุงูู ูุน ูู ุดูุก
const filteredProducts = products; // ุจุณุงุทุฉ!
```

---

## ๐ฏ ููู ูุนูู ุงููุธุงู ุงูุขู

### ููู Admin ุงูุฐู ูุฎุชุงุฑ ุดุฑูุฉ ุงูุฅูุงุฑุงุช:

#### 1. ุงูุจุญุซ ุนู "ุจูุงุท":
```
โ ูุจุญุซ ูู ุฃุตูุงู ุงูุฅูุงุฑุงุช
โ ูุจุญุซ ูู ุฃุตูุงู ุงูุชูุงุฒู
โ ููุฑุฌุน ุฌููุน ุงููุชุงุฆุฌ ุงููุทุงุจูุฉ
```

#### 2. ุงููุชุงุฆุฌ:
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ุจูุงุท ุฅูุงุฑุงุชู ุฃุจูุถ                      โ  โ ูู ุงูุฅูุงุฑุงุช
โ ุจูุงุท ุฅูุงุฑุงุชู ุฃุฒุฑู                      โ  โ ูู ุงูุฅูุงุฑุงุช
โ ุจูุงุท ุฑุฎุงู [ูุฎุฒู ุงูุชูุงุฒู] ๐           โ  โ ูู ุงูุชูุงุฒู
โ ุจูุงุท ุณูุฑุงููู [ูุฎุฒู ุงูุชูุงุฒู] ๐         โ  โ ูู ุงูุชูุงุฒู
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ูููุณุชุฎุฏู ุงูุนุงุฏู ูู ุงูุฅูุงุฑุงุช:

#### 1. ุงูุจุญุซ ุนู "ุจูุงุท":
```
โ ูุจุญุซ ูู ุฃุตูุงู ุงูุฅูุงุฑุงุช (ุดุฑูุชู)
โ ูุจุญุซ ูู ุฃุตูุงู ุงูุชูุงุฒู (ุงูุดุฑูุฉ ุงูุฃู)
โ ูุง ูุฑู ุฃุตูุงู ุงูุดุฑูุงุช ุงูุฃุฎุฑู
```

#### 2. ุงููุชุงุฆุฌ:
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ุจูุงุท ุฅูุงุฑุงุชู ุฃุจูุถ                      โ  โ ูู ุดุฑูุชู
โ ุจูุงุท ุฅูุงุฑุงุชู ุฃุฒุฑู                      โ  โ ูู ุดุฑูุชู
โ ุจูุงุท ุฑุฎุงู [ูุฎุฒู ุงูุชูุงุฒู] ๐           โ  โ ูู ุงูุชูุงุฒู
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ง ุงูุชุบููุฑุงุช ุงูุชูููุฉ

### Backend (`ProductService.ts`):

#### 1. ุจูุงุก ุดุฑูุท ุงูุดุฑูุฉ:
```typescript
let companyConditions: Prisma.ProductWhereInput[] = [];

if (isSystemUser && companyId) {
  if (companyId === 1) {
    companyConditions = [{ createdByCompanyId: 1 }];
  } else {
    companyConditions = [
      { createdByCompanyId: companyId },
      { createdByCompanyId: 1 }
    ];
  }
} else if (!isSystemUser) {
  if (userCompanyId === 1) {
    companyConditions = [{ createdByCompanyId: 1 }];
  } else {
    companyConditions = [
      { createdByCompanyId: userCompanyId },
      { createdByCompanyId: 1 }
    ];
  }
}
```

#### 2. ุจูุงุก ุดุฑูุท ุงูุจุญุซ:
```typescript
const searchConditions: Prisma.ProductWhereInput[] = [];

if (search) {
  searchConditions.push({ 
    name: { contains: search, mode: Prisma.QueryMode.insensitive } 
  });
}
```

#### 3. ุฏูุฌ ุงูุดุฑูุท:
```typescript
if (companyConditions.length > 0 && searchConditions.length > 0) {
  whereConditions.AND = [
    { OR: companyConditions },
    { OR: searchConditions }
  ];
} else if (companyConditions.length > 0) {
  whereConditions.OR = companyConditions;
} else if (searchConditions.length > 0) {
  whereConditions.OR = searchConditions;
}
```

### Frontend (`damage-reports/page.tsx`):

#### 1. ุงูุจุญุซ ุงููุจุงุดุฑ:
```typescript
const { data: productsData } = useGetProductsQuery({
  companyId: isSystemUser ? selectedCompanyId || undefined : userCompanyId,
  search: productSearchTerm || undefined,
  limit: 50,
}, {
  skip: !productSearchTerm,
});
```

#### 2. ุชุจุณูุท ุงูุชุตููุฉ:
```typescript
const filteredProducts = products; // Backend ูุชุนุงูู ูุน ูู ุดูุก
```

---

## ๐ ุงูุฃุฏุงุก

### ูุจู ุงูุฅุตูุงุญ:
```
โ ุฌูุจ 1000+ ุตูู ูู ูู ูุฑุฉ
โ ุชุตููุฉ ูู Frontend (ุจุทุก)
โ ุงุณุชููุงู ุฐุงูุฑุฉ ุนุงูู
โ ุดุจูุฉ ูุญููุฉ ุจุงูุจูุงูุงุช
```

### ุจุนุฏ ุงูุฅุตูุงุญ:
```
โ ุฌูุจ 50 ูุชูุฌุฉ ููุท
โ ุชุตููุฉ ูู Database (ุณุฑูุน)
โ ุงุณุชููุงู ุฐุงูุฑุฉ ูููู
โ ุดุจูุฉ ูุญุณูุฉ
```

---

## ๐งช ุงุฎุชุจุงุฑ ุงูุฅุตูุงุญ

### ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ:
1. ุณุฌู ุฏุฎูู ูู Admin
2. ุงุฎุชุฑ "ุดุฑูุฉ ุงูุฅูุงุฑุงุช"
3. ุงุถุบุท "ุฅูุดุงุก ูุญุถุฑ ุฅุชูุงู"
4. ุงุจุญุซ ุนู "ุจูุงุท"
5. โ ูุฌุจ ุฃู ุชุธูุฑ ุฌููุน ุฃุตูุงู ุงูุจูุงุท (ุฅูุงุฑุงุช + ุชูุงุฒู)

### ุงุฎุชุจุงุฑ ุดุงูู:
```
โ ุงูุจุญุซ ุนู "ุจูุงุท" โ ุฌููุน ุฃุตูุงู ุงูุจูุงุท
โ ุงูุจุญุซ ุนู "ุฑุฎุงู" โ ุฌููุน ุฃุตูุงู ุงูุฑุฎุงู
โ ุงูุจุญุซ ุนู "UAE-001" โ ุงูุตูู ุจุงูููุฏ ุงููุญุฏุฏ
โ ุงูุจุญุซ ุนู "ุณูุฑุงููู" โ ุฌููุน ุฃุตูุงู ุงูุณูุฑุงููู
```

---

## โ ุงูููุงุฆุฏ

- ๐ **ุฃุฏุงุก ุฃุณุฑุน:** ุงูุจุญุซ ูู Database ุจุฏูุงู ูู Frontend
- ๐ **ุจุญุซ ุดุงูู:** ุฌููุน ุงูุฃุตูุงู ุงููุชุงุญุฉ ููุดุฑูุฉ
- ๐พ **ุฐุงูุฑุฉ ุฃูู:** ุฌูุจ ุงููุชุงุฆุฌ ุงููุทููุจุฉ ููุท
- ๐ **ุดุจูุฉ ูุญุณูุฉ:** ุจูุงูุงุช ุฃูู ุนุจุฑ ุงูุฅูุชุฑูุช
- ๐ฏ **ุฏูุฉ ุฃุนูู:** ุชุตููุฉ ุตุญูุญุฉ ุญุณุจ ุงูุดุฑูุฉ

---

## ๐ ุฌุงูุฒ ููุงุณุชุฎุฏุงู!

ุงููุธุงู ุงูุขู ูุฏุนู ุงูุจุญุซ ุงูุดุงูู:
- โ ุงูุจุญุซ ูู ุฌููุน ุงูุฃุตูุงู ุงููุชุงุญุฉ
- โ ุฃุฏุงุก ุณุฑูุน ููุญุณู
- โ ูุชุงุฆุฌ ุฏูููุฉ ุญุณุจ ุงูุดุฑูุฉ
- โ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ููุชุงุฒุฉ

**๐ ููููู ุงูุขู ุงูุจุญุซ ูู ุฌููุน ุงูุฃุตูุงู ุจูุฌุงุญ!**
