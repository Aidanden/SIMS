# โ๏ธ ููุฒุฉ ุชุนุฏูู ูุงุชูุฑุฉ ุงููุจูุนุงุช

## ๐ ููุฎุต ุงูููุฒุฉ

ุชู ุฅุถุงูุฉ ููุฒุฉ **ุชุนุฏูู ูุงุชูุฑุฉ ุงููุจูุนุงุช** ูู ุดุงุดุฉ ุงููุญุงุณุจุ ููุง ูุณูุญ ุจุชุนุฏูู ุฑูู ุงููุงุชูุฑุฉ ูุงูุนููู ูุจู ุงุนุชูุงุฏ ุงููุงุชูุฑุฉ.

---

## โจ ุงููุฒุงูุง ุงูุฌุฏูุฏุฉ

### 1. **ุฒุฑ ุชุนุฏูู ูู ุดุงุดุฉ ุงููุญุงุณุจ**
- โ ูุธูุฑ ุจุฌุงูุจ ุฒุฑ "ุงุนุชูุงุฏ ุงููุงุชูุฑุฉ" ููููุงุชูุฑ ุจุญุงูุฉ `DRAFT`
- โ ุชุตููู ุนุตุฑู ูุน ุฃููููุฉ ููู
- โ ูุชุนุทู ุฃุซูุงุก ุงูุชุนุฏูู ูููุน ุงูุชุนุฏููุงุช ุงููุชุฒุงููุฉ

### 2. **modal ุชุนุฏูู ุงุญุชุฑุงูู**
- โ ุนุฑุถ ูุนูููุงุช ุงููุงุชูุฑุฉ ุงูุญุงููุฉ (ุฑูู ุงููุงุชูุฑุฉุ ุงูุนูููุ ุงููุฌููุน)
- โ ุชุนุฏูู ุฑูู ุงููุงุชูุฑุฉ
- โ ุชุบููุฑ ุงูุนููู ูู ูุงุฆูุฉ ููุณุฏูุฉ
- โ ุฑุณุงูุฉ ุชุญุฐูุฑูุฉ: ูุง ูููู ุชุนุฏูู ุงูุฃุตูุงู/ุงููููุงุช
- โ ุชุญุฏูุซ ููุฑู ูู ุงููุงุฌูุฉ

### 3. **ุงูุชูุงูู ุงููุงูู ูุน API**
- โ ุงุณุชุฎุฏุงู `useUpdateSaleMutation` ูู RTK Query
- โ ุฅุนุงุฏุฉ ุฌูุจ ุงูุจูุงูุงุช ุชููุงุฆูุงู ุจุนุฏ ุงูุชุนุฏูู
- โ ุฅุดุนุงุฑุงุช ูุฌุงุญ/ูุดู ูุงุถุญุฉ

---

## ๐๏ธ ุงูุจููุฉ ุงูุชูููุฉ

### Backend (ููุฌูุฏ ูุณุจูุงู โ)

#### 1. **API Endpoint**
```
PUT /api/sales/:id
```

#### 2. **Service Method**
```typescript
// server/src/services/SalesService.ts
async updateSale(
  id: number, 
  data: UpdateSaleDto, 
  userCompanyId: number, 
  isSystemUser: boolean = false
)
```

**ุงููุธุงุฆู:**
- โ ุงูุชุญูู ูู ุตูุงุญูุฉ ุงููุณุชุฎุฏู ูุชุนุฏูู ุงููุงุชูุฑุฉ
- โ ุฅุฑุฌุงุน ุงููุฎุฒูู ููุญุงูุฉ ุงูุณุงุจูุฉ (ุฅุฐุง ุชู ุชุนุฏูู ุงูุฃุตูุงู)
- โ ุงูุชุญูู ูู ุชููุฑ ุงููุฎุฒูู ููุฃุตูุงู ุงูุฌุฏูุฏุฉ
- โ ุชุญุฏูุซ ุงููุงุชูุฑุฉ ูุน ุงูุฃุณุทุฑ
- โ ุฎุตู ุงููุฎุฒูู ููุฃุตูุงู ุงูุฌุฏูุฏุฉ

#### 3. **Controller**
```typescript
// server/src/controllers/SalesController.ts
async updateSale(req: Request, res: Response): Promise<void>
```

---

### Frontend

#### 1. **RTK Query API**
```typescript
// client/src/state/salesApi.ts
updateSale: builder.mutation<
  { success: boolean; message: string; data: Sale }, 
  { id: number; data: UpdateSaleRequest }
>({
  query: ({ id, data }) => ({
    url: `sales/${id}`,
    method: "PUT",
    body: data,
  }),
  invalidatesTags: (result, error, { id }) => [
    { type: "Sale", id },
    { type: "Sales", id: "LIST" },
    { type: "SalesStats", id: "STATS" },
  ],
})
```

**Hook:**
```typescript
const [updateSale, { isLoading: isUpdating }] = useUpdateSaleMutation();
```

#### 2. **States in Accountant Page**
```typescript
// client/src/app/accountant/page.tsx
const [showEditModal, setShowEditModal] = useState(false);
const [saleToEdit, setSaleToEdit] = useState<Sale | null>(null);
```

#### 3. **Handler Functions**
```typescript
// ูุชุญ modal ุงูุชุนุฏูู
const handleEditSale = (sale: Sale) => {
  setSaleToEdit(sale);
  setShowEditModal(true);
};

// ุญูุธ ุงูุชุนุฏููุงุช
const handleEditSubmit = async (e: React.FormEvent) => {
  e.preventDefault();
  if (!saleToEdit) return;

  const formData = new FormData(e.target as HTMLFormElement);
  const customerId = formData.get('customerId') 
    ? Number(formData.get('customerId')) 
    : undefined;
  const invoiceNumber = formData.get('invoiceNumber') as string;

  try {
    await updateSale({
      id: saleToEdit.id,
      data: {
        customerId,
        invoiceNumber: invoiceNumber || undefined,
      }
    }).unwrap();

    success(`ุชู ุชุนุฏูู ุงููุงุชูุฑุฉ ${saleToEdit.invoiceNumber} ุจูุฌุงุญ`);
    setShowEditModal(false);
    setSaleToEdit(null);
    
    // Refresh data
    refetch();
    refetchPending();
    refetchIssued();
  } catch (err: any) {
    showError(err?.data?.message || 'ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชุนุฏูู ุงููุงุชูุฑุฉ');
  }
};
```

---

## ๐จ ูุงุฌูุฉ ุงููุณุชุฎุฏู

### 1. **ุฒุฑ ุงูุชุนุฏูู**
```jsx
<div className="flex gap-2">
  {/* ุฒุฑ ุงูุชุนุฏูู */}
  <button
    onClick={() => handleEditSale(sale)}
    disabled={isUpdating}
    className="inline-flex items-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 transition-colors"
    title="ุชุนุฏูู ุงููุงุชูุฑุฉ"
  >
    <svg className="h-4 w-4 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} 
        d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
    </svg>
    ุชุนุฏูู
  </button>

  {/* ุฒุฑ ุงูุงุนุชูุงุฏ */}
  <button onClick={() => handleApproveSale(sale)}>
    ุงุนุชูุงุฏ ุงููุงุชูุฑุฉ
  </button>
</div>
```

### 2. **Modal ุงูุชุนุฏูู**
- **ุงูุนููุงู:** ุฎูููุฉ ุจุฑุชูุงููุฉ ูุน ุฃููููุฉ ููู
- **ุงููุญุชูู:**
  - ูุณู ูุนูููุงุช ุงููุงุชูุฑุฉ ุงูุญุงููุฉ (ุฎูููุฉ ุฑูุงุฏูุฉ)
  - ุญูู ุชุนุฏูู ุฑูู ุงููุงุชูุฑุฉ
  - ูุงุฆูุฉ ููุณุฏูุฉ ูุชุบููุฑ ุงูุนููู
  - ุฑุณุงูุฉ ุชุญุฐูุฑูุฉ (ุตูุฑุงุก) ุญูู ุนุฏู ุฅููุงููุฉ ุชุนุฏูู ุงูุฃุตูุงู
- **ุงูุฃุฒุฑุงุฑ:**
  - ุฅูุบุงุก (ุฑูุงุฏู)
  - ุญูุธ ุงูุชุนุฏููุงุช (ุจุฑุชูุงูู) ูุน ูุคุดุฑ ุชุญููู

---

## ๐ ุงููููุฏ ูุงูุตูุงุญูุงุช

### ูุง ูููู ุชุนุฏููู:
- โ ุฑูู ุงููุงุชูุฑุฉ
- โ ุงูุนููู

### ูุง ูุง ูููู ุชุนุฏููู:
- โ ุงูุฃุตูุงู (productId, qty, unitPrice)
- โ ููุน ุงูุจูุน (saleType) - ููุญุฏุฏ ุนูุฏ ุงูุงุนุชูุงุฏ
- โ ุทุฑููุฉ ุงูุฏูุน (paymentMethod) - ุชูุญุฏุฏ ุนูุฏ ุงูุงุนุชูุงุฏ

### ุงูุตูุงุญูุงุช:
- **ูุณุชุฎุฏู ุนุงุฏู:** ููููู ุชุนุฏูู ููุงุชูุฑ ุดุฑูุชู ููุท
- **ูุณุชุฎุฏู ุงููุธุงู:** ููููู ุชุนุฏูู ููุงุชูุฑ ุฃู ุดุฑูุฉ

### ุงูุญุงูุงุช:
- โ ูููู ุงูุชุนุฏูู ููููุงุชูุฑ ุจุญุงูุฉ `DRAFT` ููุท
- โ ูุง ูููู ุงูุชุนุฏูู ููููุงุชูุฑ ุจุญุงูุฉ `APPROVED` ุฃู `CANCELLED`

---

## ๐ธ ูุซุงู ุนูู ุณูุฑ ุงูุนูู

```
1. ุงููุญุงุณุจ ููุชุญ ุดุงุดุฉ ุงููุญุงุณุจ
   โ
2. ูุฑู ูุงุฆูุฉ ุงูููุงุชูุฑ ุงููุนููุฉ (DRAFT)
   โ
3. ููุงุญุธ ุฎุทุฃ ูู ุฑูู ุงููุงุชูุฑุฉ ุฃู ุงูุนููู
   โ
4. ูููุฑ ุนูู ุฒุฑ "ุชุนุฏูู" ุจุฌุงูุจ ุงููุงุชูุฑุฉ
   โ
5. ููุชุญ modal ุงูุชุนุฏูู ูุน ุงููุนูููุงุช ุงูุญุงููุฉ
   โ
6. ูุนุฏู ุฑูู ุงููุงุชูุฑุฉ ุฃู ุงูุนููู
   โ
7. ูููุฑ ุนูู "ุญูุธ ุงูุชุนุฏููุงุช"
   โ
8. ูุชู ุงูุชุญุฏูุซ ููุฑุงู ูู ุงููุงุฆูุฉ
   โ
9. ููููู ุงูุขู ุงุนุชูุงุฏ ุงููุงุชูุฑุฉ
```

---

## ๐งช ููููุฉ ุงูุงุฎุชุจุงุฑ

### 1. **ุงุฎุชุจุงุฑ ุงูุชุนุฏูู ุงูุฃุณุงุณู:**
```bash
1. ุงูุชุญ ุดุงุดุฉ ุงููุญุงุณุจ
2. ุงุจุญุซ ุนู ูุงุชูุฑุฉ ุจุญุงูุฉ DRAFT
3. ุงููุฑ ุนูู ุฒุฑ "ุชุนุฏูู"
4. ุบููุฑ ุฑูู ุงููุงุชูุฑุฉ
5. ุบููุฑ ุงูุนููู
6. ุงููุฑ ุนูู "ุญูุธ ุงูุชุนุฏููุงุช"
7. ุชุญูู ูู ุธููุฑ ุงูุชุนุฏููุงุช ูู ุงููุงุฆูุฉ
```

### 2. **ุงุฎุชุจุงุฑ ุงูุชุญุฏูุซ ุงูููุฑู:**
```bash
1. ุงูุชุญ ุดุงุดุฉ ุงููุญุงุณุจ ูู ุชุจููุจูู ูุฎุชูููู
2. ุนุฏูู ูุงุชูุฑุฉ ูู ุงูุชุจููุจ ุงูุฃูู
3. ุชุญูู ูู ุชุญุฏูุซ ุงูุจูุงูุงุช ูู ุงูุชุจููุจ ุงูุซุงูู
```

### 3. **ุงุฎุชุจุงุฑ ุงูุตูุงุญูุงุช:**
```bash
# ููุณุชุฎุฏู ุนุงุฏู:
1. ุญุงูู ุชุนุฏูู ูุงุชูุฑุฉ ูู ุดุฑูุฉ ุฃุฎุฑู
2. ูุฌุจ ุฃู ุชุธูุฑ ุฑุณุงูุฉ ุฎุทุฃ "ุบูุฑ ูุตุฑุญ ูู"

# ููุณุชุฎุฏู ูุธุงู:
1. ููููู ุชุนุฏูู ููุงุชูุฑ ุฃู ุดุฑูุฉ
```

### 4. **ุงุฎุชุจุงุฑ ุงููููุฏ:**
```bash
1. ุญุงูู ุชุนุฏูู ูุงุชูุฑุฉ ูุนุชูุฏุฉ (APPROVED)
2. ูุฌุจ ุฃูุง ูุธูุฑ ุฒุฑ "ุชุนุฏูู"
3. ููุท ุงูููุงุชูุฑ ุงููุนููุฉ (DRAFT) ูููู ุชุนุฏูููุง
```

---

## ๐ฏ ุงูููุงุฆุฏ

### ูููุญุงุณุจ:
- โ ุชุตุญูุญ ุงูุฃุฎุทุงุก ุงูุจุณูุทุฉ ุจุณูููุฉ
- โ ุชุญุฏูุซ ูุนูููุงุช ุงููุงุชูุฑุฉ ูุจู ุงูุงุนุชูุงุฏ
- โ ูุงุฌูุฉ ุจุฏูููุฉ ูุณุฑูุนุฉ

### ูููุธุงู:
- โ ูุฑููุฉ ุฃูุจุฑ ูู ุฅุฏุงุฑุฉ ุงูููุงุชูุฑ
- โ ุชูููู ุงูุญุงุฌุฉ ูุญุฐู ูุฅุนุงุฏุฉ ุฅูุดุงุก ุงูููุงุชูุฑ
- โ ุงูุญูุงุธ ุนูู ุณูุงูุฉ ุงูุจูุงูุงุช

### ููุชุทููุฑ ุงููุณุชูุจูู:
- โ ุฃุณุงุณ ููู ูุฅุถุงูุฉ ููุฒุงุช ุชุนุฏูู ุฃูุซุฑ ุชูุฏูุงู
- โ ููุท ูุงุจู ููุชุทุจูู ุนูู modals ุฃุฎุฑู
- โ ููุฏ ูุธูู ููุงุจู ููุตูุงูุฉ

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

### 1. **ุนุฏู ุชุนุฏูู ุงูุฃุตูุงู:**
- ุญุงููุงูุ ูุง ูููู ุชุนุฏูู ุงูุฃุตูุงู ุฃู ุงููููุงุช
- ูุฐุง ูุญูุงูุฉ ุงููุฎุฒูู ูู ุงูุชูุงูุถุงุช
- ูู ุงููุณุชูุจูุ ูููู ุฅุถุงูุฉ ููุฒุฉ ุชุนุฏูู ูุชูุฏูุฉ ูุน ุฅุฏุงุฑุฉ ุงููุฎุฒูู

### 2. **ุงูุชุญุฏูุซ ุงูููุฑู:**
- ูุณุชุฎุฏู ุงููุธุงู `invalidatesTags` ูู RTK Query
- ุงูุชุญุฏูุซุงุช ุชุธูุฑ ููุฑุงู ูู ุฌููุน ุงูุฃูุงูู
- ูุชู ุฅุนุงุฏุฉ ุฌูุจ ุงูุจูุงูุงุช ุชููุงุฆูุงู

### 3. **ุงูุฃูุงู:**
- ุฌููุน ุงูุชุนุฏููุงุช ุชูุฑ ุนุจุฑ ุงูุชุญูู ูู ุงูุตูุงุญูุงุช
- ุงููุณุชุฎุฏููู ุงูุนุงุฏููู ูุญุฏูุฏูู ุจุดุฑูุงุชูู ููุท
- ูุณุชุฎุฏูู ุงููุธุงู ููู ุตูุงุญูุงุช ูุงููุฉ

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ (ุงุฎุชูุงุฑูุฉ)

### 1. **ุชุนุฏูู ุงูุฃุตูุงู:**
- ุฅุถุงูุฉ ูุงุฌูุฉ ูุชุนุฏูู ุงูุฃุตูุงู ูุงููููุงุช
- ุฅุฏุงุฑุฉ ุงููุฎุฒูู ุจุดูู ุฏููุงูููู
- ุงูุชุญูู ูู ุงูุชููุฑ ูุจู ุงูุญูุธ

### 2. **ุณุฌู ุงูุชุนุฏููุงุช:**
- ุชุชุจุน ูู ูุงู ุจุงูุชุนุฏูู ููุชู
- ุนุฑุถ ุชุงุฑูุฎ ุงูุชุนุฏููุงุช ููู ูุงุชูุฑุฉ
- ุฅููุงููุฉ ุงูุชุฑุงุฌุน ุนู ุงูุชุนุฏููุงุช

### 3. **ุฅุดุนุงุฑุงุช:**
- ุฅุดุนุงุฑ ุงููุฏูุฑ ุนูุฏ ุชุนุฏูู ูุงุชูุฑุฉ
- ุชุฃููุฏ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ููุชุนุฏููุงุช ุงููุงูุฉ

---

## ๐ ุงููููุงุช ุงููุนุฏูุฉ

### Backend (ูุงู ููุฌูุฏุงู ูุณุจูุงู):
- โ `server/src/services/SalesService.ts`
- โ `server/src/controllers/SalesController.ts`
- โ `server/src/routes/salesRoutes.ts`
- โ `server/src/dto/salesDto.ts`

### Frontend (ุฌุฏูุฏ):
- โ `client/src/app/accountant/page.tsx`
  - ุฅุถุงูุฉ states ููุชุนุฏูู
  - ุฅุถุงูุฉ hooks ูู `useUpdateSaleMutation`
  - ุฅุถุงูุฉ ุฏูุงู `handleEditSale` ู `handleEditSubmit`
  - ุฅุถุงูุฉ ุฒุฑ "ุชุนุฏูู" ูู ุงูุฌุฏูู
  - ุฅุถุงูุฉ Edit Modal

---

## โ ุงูุฎูุงุตุฉ

ุชู ุจูุฌุงุญ ุฅุถุงูุฉ ููุฒุฉ **ุชุนุฏูู ูุงุชูุฑุฉ ุงููุจูุนุงุช** ูู ุดุงุดุฉ ุงููุญุงุณุจ:

1. โ ุฒุฑ ุชุนุฏูู ุงุญุชุฑุงูู ุจุฌุงูุจ ุฒุฑ ุงูุงุนุชูุงุฏ
2. โ Modal ุชุนุฏูู ุฌููู ูุณูู ุงูุงุณุชุฎุฏุงู
3. โ ุชูุงูู ูุงูู ูุน API ููุฌูุฏ
4. โ ุชุญุฏูุซ ููุฑู ูู ุงููุงุฌูุฉ
5. โ ุฅุดุนุงุฑุงุช ูุฌุงุญ/ูุดู ูุงุถุญุฉ
6. โ ุญูุงูุฉ ูุงููุฉ ููุตูุงุญูุงุช

**ุงูููุฒุฉ ุฌุงูุฒุฉ ููุงุณุชุฎุฏุงู ุงูููุฑู! ๐**

---

**ุชุงุฑูุฎ ุงูุฅุถุงูุฉ:** 2025-11-04  
**ุงูุฅุตุฏุงุฑ:** 1.0.0  
**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุฅูุชุงุฌ

