# ููุฎุต ุดุงูู ููุธุงู ุงููุจูุนุงุช ุงููุนูุฏุฉ ุจูู ุงูุดุฑูุงุช

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ:

ูุธุงู ุงููุจูุนุงุช ุงููุนูุฏุฉ ูุณูุญ ุจุฅูุดุงุก ุนูููุงุช ุจูุน ูู **ุงูุดุฑูุฉ ุงูุฃู** ุฅูู **ุงูุนููู ุงูููุงุฆู** ุนุจุฑ **ุงูุดุฑูุฉ ุงููุฑุนูุฉ**ุ ูุน ุฅูุดุงุก ูุงุชูุฑุชูู ุชููุงุฆูุงู ูุฎุตู ุงููุฎุฒูู ูู ุงูุดุฑูุฉ ุงูุฃู.

---

## ๐ ุงูููููุงุช ุงูุฃุณุงุณูุฉ:

### 1. ุงูููุงุชูุฑ ุงูููุดุฃุฉ:
```
ูุงุชูุฑุฉ 1: ุงูุดุฑูุฉ ุงูุฃู โ ุงูุดุฑูุฉ ุงููุฑุนูุฉ (ุขุฌู)
ูุงุชูุฑุฉ 2: ุงูุดุฑูุฉ ุงููุฑุนูุฉ โ ุงูุนููู ุงูููุงุฆู (ููุฏู/ุขุฌู)
```

### 2. ุงูุฃุทุฑุงู ุงููุดุงุฑูุฉ:
- **ุงูุดุฑูุฉ ุงูุฃู**: ูุตุฏุฑ ุงูุจุถุงุนุฉ (ูุซู: ุงูุชูุงุฒู)
- **ุงูุดุฑูุฉ ุงููุฑุนูุฉ**: ุงููุณูุท ุงููุณุชูู (ูุซู: ุงูุฅูุงุฑุงุช)
- **ุงูุนููู ุงูููุงุฆู**: ุงููุดุชุฑู ุงููุนูู (ูุซู: ูุญูุฏ ุฃุญูุฏ)

### 3. ุงูุนููู ุงููููู:
- ููุซู ุงูุดุฑูุฉ ุงููุฑุนูุฉ ูุนููู ููุดุฑูุฉ ุงูุฃู
- ูููุดุฃ ุชููุงุฆูุงู ุนูุฏ ุฅุถุงูุฉ ุดุฑูุฉ ูุฑุนูุฉ
- ุงููุนุฑู: `BRANCH-{companyId}`

---

## ๐ง ุงูุชุญุฏูุซุงุช ุงููุทุจูุฉ:

### 1. ุฅุถุงูุฉ ุงุฎุชูุงุฑ ุงูุดุฑูุฉ ุงููุฑุนูุฉ ูู UI:
**ุงูููู**: `/client/src/app/complex-inter-company-sales/page.tsx`

**ุงูุชุบููุฑุงุช**:
- โ ุฅุถุงูุฉ state: `selectedBranchCompany`
- โ ููุชุฑุฉ ุงูุดุฑูุงุช ุงููุฑุนูุฉ: `isParent === false && parentId !== null`
- โ ุญูู ุงุฎุชูุงุฑ ูู ุงููุงุฌูุฉ: "ุงูุดุฑูุฉ ุงููุฑุนูุฉ (ุงููุณุชููุฉ)"
- โ Validation: ุงูุชุญูู ูู ุงุฎุชูุงุฑ ุงูุดุฑูุฉ ุงููุฑุนูุฉ
- โ ุฅุฑุณุงู `branchCompanyId` ูู ุงูุทูุจ

**ูุจู**:
```typescript
branchCompanyId: currentCompanyId  // โ ุชููุงุฆู
```

**ุจุนุฏ**:
```typescript
branchCompanyId: selectedBranchCompany  // โ ูู ุงูุงุฎุชูุงุฑ
```

---

### 2. ุฅุตูุงุญ ููุทู ุงูุนููู ูู ุงูููุงุชูุฑ:
**ุงูููู**: `/server/src/services/ComplexInterCompanySaleService.ts`

**ุงููุดููุฉ**:
```typescript
// โ ูุจู: ุงูุนููู ุงูููุงุฆู ูู ููุง ุงููุงุชูุฑุชูู
customerId: data.customerId
```

**ุงูุญู**:
```typescript
// โ ุจุนุฏ: ุงูุดุฑูุฉ ุงููุฑุนูุฉ ูุนููู ูู ูุงุชูุฑุฉ ุงูุฃู
customerId: branchAsCustomer.id  // ุนููู ูููู ููุซู ุงููุฑุน
```

**ุงููุชูุฌุฉ**:
- ูุงุชูุฑุฉ ุงูุฃู: ุงูุชูุงุฒู โ ุงูุฅูุงุฑุงุช (ูุนููู)
- ูุงุชูุฑุฉ ุงููุฑุน: ุงูุฅูุงุฑุงุช โ ูุญูุฏ ุฃุญูุฏ (ุงูุนููู ุงูุญูููู)

---

### 3. ุฅุตูุงุญ ุธููุฑ ุงูููุงุชูุฑ ูู ุงููุจูุนุงุช ุงูุขุฌูุฉ:
**ุงูููู**: `/server/src/services/SalePaymentService.ts`

**ุงููุดููุฉ**:
```typescript
// โ ูุจู: ููุท ุงููุจูุนุงุช ุงูุชู ุงูุดุฑูุฉ ุจุงุฆุน ูููุง
where: {
  saleType: 'CREDIT',
  companyId: userCompanyId
}
```

**ุงูุญู**:
```typescript
// โ ุจุนุฏ: ุงููุจูุนุงุช ุงูุชู ุงูุดุฑูุฉ ุจุงุฆุน ุฃู ุนููู ูููุง
const branchAsCustomer = await this.prisma.customer.findFirst({
  where: { phone: `BRANCH-${userCompanyId}` }
});

where.OR = [
  { companyId: userCompanyId },  // ุจุงุฆุน
  ...(branchAsCustomer ? [{ customerId: branchAsCustomer.id }] : [])  // ุนููู
];
```

**ุงููุชูุฌุฉ**:
- ูุณุชุฎุฏู ุงูุฅูุงุฑุงุช ูุฑู ูุงุชูุฑุชูู ูู ุงููุจูุนุงุช ุงูุขุฌูุฉ:
  1. ูู ุงูุชูุงุฒู โ ุงูุฅูุงุฑุงุช (ุฏูู ุนูู ุงูุฅูุงุฑุงุช)
  2. ูู ุงูุฅูุงุฑุงุช โ ุงูุนููู (ุฏูู ููุฅูุงุฑุงุช)

---

### 4. ุฅูุดุงุก ุนููู ูููู ุชููุงุฆูุงู:
**ุงูููู**: `/server/src/services/CompanyService.ts`

**ุงูุชุญุฏูุซ**:
```typescript
// ุจุนุฏ ุฅูุดุงุก ุงูุดุฑูุฉ ุงููุฑุนูุฉ ุจูุฌุงุญ
if (!data.isParent && result.id) {
  try {
    const dummyCustomer = await this.prisma.customer.create({
      data: {
        name: result.name,
        phone: `BRANCH-${result.id}`,
        note: `ุนููู ูููู ููุซู ุงูุดุฑูุฉ ุงููุฑุนูุฉ: ${result.name}`
      }
    });
    console.log('โ Dummy customer created for branch company:', dummyCustomer);
  } catch (customerError) {
    console.error('โ๏ธ Failed to create dummy customer (non-critical):', customerError);
  }
}
```

**ุงููุงุฆุฏุฉ**:
- ุงูุนููู ุงููููู ูููุดุฃ ูุฑุฉ ูุงุญุฏุฉ ุนูุฏ ุฅุถุงูุฉ ุงูุดุฑูุฉ
- ุฌุงูุฒ ููุงุณุชุฎุฏุงู ูู ุงููุจูุนุงุช ุงููุนูุฏุฉ ููุฑุงู
- ูุง ุญุงุฌุฉ ููุชุญูู ูุงูุฅูุดุงุก ูู ูู ุนูููุฉ

---

## ๐ ูุซุงู ูุงูู:

### ุงูุณููุงุฑูู:
```
ุงูุดุฑูุฉ ุงูุฃู: ุดุฑูุฉ ุงูุชูุงุฒู (ID: 1)
ุงูุดุฑูุฉ ุงููุฑุนูุฉ: ุดุฑูุฉ ุงูุฅูุงุฑุงุช (ID: 2)
ุงูุนููู ุงูููุงุฆู: ูุญูุฏ ุฃุญูุฏ (ID: 5)
ุงูุนููู ุงููููู: ุดุฑูุฉ ุงูุฅูุงุฑุงุช (ID: 10, Phone: BRANCH-2)

ุงูููุชุฌ: ุจูุงุท ุณูุฑุงููู
ุงููููุฉ: 100 ูุชุฑ ูุฑุจุน
ุณุนุฑ ุงูุฃู: 10 ุฏ.ู/ูยฒ
ูุงูุด ุงูุฑุจุญ: 20%
ุณุนุฑ ุงูุนููู: 12 ุฏ.ู/ูยฒ
```

### ุงููุชูุฌุฉ:

#### 1. ูุงุชูุฑุฉ ุงูุฃู (ุขุฌู):
```
ID: 1001
Invoice: PR-1-1234567890
ุงูุจุงุฆุน: ุดุฑูุฉ ุงูุชูุงุฒู (ID: 1)
ุงูุนููู: ุดุฑูุฉ ุงูุฅูุงุฑุงุช (ID: 10) โ ุนููู ูููู
ุงูููุน: ุขุฌู (CREDIT)
ุงููุจูุบ: 1000 ุฏ.ู (100 ร 10)
ุงููุฏููุน: 0 ุฏ.ู
ุงููุชุจูู: 1000 ุฏ.ู
ุงูุญุงูุฉ: ุบูุฑ ูุฏููุน
```

#### 2. ูุงุชูุฑุฉ ุงููุฑุน (ููุฏู/ุขุฌู):
```
ID: 1002
Invoice: BR-2-1234567891
ุงูุจุงุฆุน: ุดุฑูุฉ ุงูุฅูุงุฑุงุช (ID: 2)
ุงูุนููู: ูุญูุฏ ุฃุญูุฏ (ID: 5) โ ุงูุนููู ุงูุญูููู
ุงูููุน: ููุฏู/ุขุฌู (ุญุณุจ ุงูุงุฎุชูุงุฑ)
ุงููุจูุบ: 1200 ุฏ.ู (100 ร 12)
ุงููุฏููุน: 1200 ุฏ.ู (ุฅุฐุง ููุฏู) ุฃู 0 (ุฅุฐุง ุขุฌู)
ุงูุฑุจุญ: 200 ุฏ.ู
```

#### 3. ุงููุฎุฒูู:
```
ูุจู ุงูุนูููุฉ:
- ุงูุชูุงุฒู: 50 ุตูุฏูู (300 ูยฒ)

ุจุนุฏ ุงูุนูููุฉ:
- ุงูุชูุงุฒู: 33.33 ุตูุฏูู (200 ูยฒ)
- ุชู ุฎุตู: 16.67 ุตูุฏูู (100 ูยฒ)
```

---

## ๐ฅ๏ธ ุงููุงุฌูุฉ ุงูุฃูุงููุฉ:

### ุงูุญููู ุจุงูุชุฑุชูุจ:
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 1. ุงูุนููู * (ุงูุนููู ุงูููุงุฆู)              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ 2. ุงูุดุฑูุฉ ุงููุฑุนูุฉ (ุงููุณุชููุฉ) *            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ 3. ุงูุดุฑูุฉ ุงูุฃู (ุงููุตุฏุฑ) *                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ 4. ูุงูุด ุงูุฑุจุญ (%)                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ 5. ููุน ูุงุชูุฑุฉ ุงูุนููู (ููุฏู/ุขุฌู)          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ 6. ุทุฑููุฉ ุงูุฏูุน (ูุงุด/ุญูุงูุฉ/ุจุทุงูุฉ)          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ 7. ุงูุจููุฏ (ุงูุฃุตูุงู ูุงููููุงุช)              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ุดุงุดุฉ ุงููุจูุนุงุช ุงูุขุฌูุฉ:

### ููุณุชุฎุฏู ุดุฑูุฉ ุงูุฅูุงุฑุงุช:

#### ุงูููุงุชูุฑ ุงููุนุฑูุถุฉ:
```
1. ูุงุชูุฑุฉ ูู ุงูุชูุงุฒู โ ุงูุฅูุงุฑุงุช
   - ุฑูู ุงููุงุชูุฑุฉ: PR-1-1234567890
   - ุงูุจุงุฆุน: ุดุฑูุฉ ุงูุชูุงุฒู
   - ุงูุนููู: ุดุฑูุฉ ุงูุฅูุงุฑุงุช
   - ุงููุจูุบ: 1000 ุฏ.ู
   - ุงููุฏููุน: 0 ุฏ.ู
   - ุงููุชุจูู: 1000 ุฏ.ู
   - ุงูุญุงูุฉ: ุบูุฑ ูุฏููุน
   - ุงูููุน: ุฏูู ุนูู ุงูุฅูุงุฑุงุช

2. ูุงุชูุฑุฉ ูู ุงูุฅูุงุฑุงุช โ ูุญูุฏ ุฃุญูุฏ
   - ุฑูู ุงููุงุชูุฑุฉ: BR-2-1234567891
   - ุงูุจุงุฆุน: ุดุฑูุฉ ุงูุฅูุงุฑุงุช
   - ุงูุนููู: ูุญูุฏ ุฃุญูุฏ
   - ุงููุจูุบ: 1200 ุฏ.ู
   - ุงููุฏููุน: 0 ุฏ.ู (ุฅุฐุง ุขุฌู)
   - ุงููุชุจูู: 1200 ุฏ.ู
   - ุงูุญุงูุฉ: ุบูุฑ ูุฏููุน
   - ุงูููุน: ุฏูู ููุฅูุงุฑุงุช
```

---

## โ ุงูููุงุฆุฏ ุงูููุงุฆูุฉ:

### 1. **ูุฑููุฉ ูุงููุฉ**:
- ุงุฎุชูุงุฑ ุฃู ุดุฑูุฉ ูุฑุนูุฉ
- ุงุฎุชูุงุฑ ุฃู ุนููู
- ุชุญุฏูุฏ ูุงูุด ุงูุฑุจุญ

### 2. **ุชุชุจุน ุฏููู**:
- ููุงุชูุฑ ูููุตูุฉ ููู ูุณุชูู
- ุนููุงุก ูููููู ูุงุถุญูู
- ุธููุฑ ูู ุงููุจูุนุงุช ุงูุขุฌูุฉ

### 3. **ูุญุงุณุจุฉ ุตุญูุญุฉ**:
- ุงูุดุฑูุฉ ุงูุฃู ุชุนุฑู ุฏููู ุงููุฑูุน ุนูููุง
- ุงููุฑุน ูุนุฑู ุฏูููู ููุฃู ูุฏููู ุงูุนููุงุก ูู
- ุญุณุงุจุงุช ูููุตูุฉ ูุฏูููุฉ

### 4. **ุฎุตู ูุฎุฒูู ุตุญูุญ**:
- ูุชู ุงูุฎุตู ูู ุงูุดุฑูุฉ ุงูุฃู ููุท
- ุญุณุงุจ ุตุญูุญ ูููุญุฏุงุช ูุงูุตูุงุฏูู
- ูุง ุชูุฑุงุฑ ูู ุงูุฎุตู

---

## ๐ ุงููููุงุช ุงููุญุฏุซุฉ:

### Frontend:
1. โ `/client/src/app/complex-inter-company-sales/page.tsx`
   - ุฅุถุงูุฉ ุงุฎุชูุงุฑ ุงูุดุฑูุฉ ุงููุฑุนูุฉ
   - Validation ูุญุณู
   - UI ูุญุฏุซ

### Backend:
1. โ `/server/src/services/ComplexInterCompanySaleService.ts`
   - ุฅุตูุงุญ ููุทู ุงูุนููู
   - ุฅูุดุงุก/ุงูุญุตูู ุนูู ุนููู ูููู

2. โ `/server/src/services/SalePaymentService.ts`
   - ุฅุตูุงุญ ุนุฑุถ ุงููุจูุนุงุช ุงูุขุฌูุฉ
   - ุฅุตูุงุญ ุงูุฅุญุตุงุฆูุงุช

3. โ `/server/src/services/CompanyService.ts`
   - ุฅูุดุงุก ุนููู ูููู ุชููุงุฆูุงู

### Documentation:
1. โ `COMPLEX_SALES_BRANCH_SELECTION.md`
2. โ `COMPLEX_SALES_CUSTOMER_FIX.md`
3. โ `CREDIT_SALES_VISIBILITY_FIX.md`
4. โ `AUTO_CREATE_DUMMY_CUSTOMER.md`
5. โ `COMPLEX_SALES_COMPLETE_SUMMARY.md` (ูุฐุง ุงูููู)

---

## ๐ ุงููุธุงู ุงูุขู ุฌุงูุฒ ุจุงููุงูู!

ุฌููุน ุงููุดุงูู ุชู ุญููุง:
- โ ุงุฎุชูุงุฑ ุงูุดุฑูุฉ ุงููุฑุนูุฉ ูู UI
- โ ุงูุนููู ุงูุตุญูุญ ูู ูู ูุงุชูุฑุฉ
- โ ุธููุฑ ุงูููุงุชูุฑ ูู ุงููุจูุนุงุช ุงูุขุฌูุฉ
- โ ุฅูุดุงุก ุนููู ูููู ุชููุงุฆูุงู
- โ ุชุชุจุน ุฏููู ููุฏููู
- โ ูุญุงุณุจุฉ ุตุญูุญุฉ

**ุงููุธุงู ูุนูู ุจุดูู ูุงูู ูููุทูู!** ๐
