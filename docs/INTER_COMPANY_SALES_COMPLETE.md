# โ ูุธุงู ุงููุจูุนุงุช ุจูู ุงูุดุฑูุงุช - ููุชูู 100%!

## ๐ ุชู ุฅูุฌุงุฒ ุงููุธุงู ุจุงููุงูู!

---

## ๐ ุงููููุงุช ุงูููุดุฃุฉ:

### Backend (Server):
1. โ `/server/src/dto/interCompanySaleDto.ts` - DTOs ู Validation
2. โ `/server/src/services/InterCompanySaleService.ts` - Business Logic
3. โ `/server/src/controllers/InterCompanySaleController.ts` - HTTP Handlers
4. โ `/server/src/routes/interCompanySaleRoutes.ts` - API Routes
5. โ `/server/src/index.ts` - Routes Integration

### Frontend (Client):
1. โ `/client/src/state/interCompanySalesApi.ts` - RTK Query API
2. โ `/client/src/app/redux.tsx` - Redux Store Integration
3. โ `/client/src/app/(components)/Sidebar/index.tsx` - Sidebar Link
4. โ `/client/src/app/inter-company-sales/page.tsx` - **ุงูุตูุญุฉ ุงููุงููุฉ**

### ุงูุชูุซูู:
1. โ `/INTER_COMPANY_SALES_SYSTEM.md` - ุงูุชูุซูู ุงูููู
2. โ `/INTER_COMPANY_SALES_READY.md` - ุญุงูุฉ ุงูุฅูุฌุงุฒ
3. โ `/INTER_COMPANY_SALES_COMPLETE.md` - ูุฐุง ุงูููู

---

## ๐จ ูููุฒุงุช ุงูุตูุญุฉ:

### 1. **ุจุทุงูุงุช ุงูุฅุญุตุงุฆูุงุช** (4 ุจุทุงูุงุช):
- ๐ **ุฅุฌูุงูู ุงููุจูุนุงุช**: ุนุฏุฏ ุงูููุงุชูุฑ
- ๐ฐ **ุงูุฅูุฑุงุฏุงุช**: ูู ุงููุจูุนุงุช ููุนููุงุก
- ๐ต **ุงูุชูููุฉ**: ูู ุงูุดุฑูุฉ ุงูุฃู
- ๐ **ุงูุฑุจุญ**: ูุน ูุณุจุฉ ูุงูุด ุงูุฑุจุญ

### 2. **ุดุฑูุท ุงูุจุญุซ ูุงูุฅุฌุฑุงุกุงุช**:
- ๐ ุจุญุซ ุจุฑูู ุงููุงุชูุฑุฉ ุฃู ุงุณู ุงูุนููู
- โ ุฒุฑ ุฅูุดุงุก ูุงุชูุฑุฉ ุฌุฏูุฏุฉ

### 3. **ุฌุฏูู ุงูููุงุชูุฑ**:
- ุฑูู ุงููุงุชูุฑุฉ
- ุงุณู ุงูุนููู
- ุงูุชุงุฑูุฎ
- ุงูุฅูุฑุงุฏุงุช
- ููุน ุงูุจูุน (ููุฏู/ุขุฌู)
- ุฒุฑ ุนุฑุถ ุงูุชูุงุตูู

### 4. **ููุฏุงู ุฅูุดุงุก ูุงุชูุฑุฉ**:
#### ุฃ. ูุนูููุงุช ุฃุณุงุณูุฉ:
- ุงุฎุชูุงุฑ ุงูุนููู (ุงุฎุชูุงุฑู)
- ููุน ุงูุจูุน (ููุฏู/ุขุฌู)
- ุทุฑููุฉ ุงูุฏูุน (ููููุฏู ููุท)

#### ุจ. ุฌุฏูู ุงูุฃุตูุงู:
- ุงุฎุชูุงุฑ ุงูุตูู ูู ุงูุดุฑูุฉ ุงูุฃู
- ุงููููุฉ
- ุณุนุฑ ุงูุดุฑูุฉ ุงูุฃู (ูููุฑุงุกุฉ ููุท)
- ุณุนุฑ ุงููุฑุน (ูุงุจู ููุชุนุฏูู)
- ุงูุฅุฌูุงูู ุงููุฑุนู
- ุฒุฑ ุญุฐู ุงูุจูุฏ

#### ุฌ. ุงูุฅุฌูุงููุงุช:
- ุงูุฅูุฑุงุฏุงุช (ูุฌููุน ุงููุจูุนุงุช)
- ุงูุชูููุฉ (ูู ุงูุดุฑูุฉ ุงูุฃู)
- ุงูุฑุจุญ (ุงููุฑู)
- ูุณุจุฉ ูุงูุด ุงูุฑุจุญ

### 5. **ููุฏุงู ุงูุชูุงุตูู**:
- ุนุฑุถ ุชูุงุตูู ุงููุงุชูุฑุฉ (ููุฏ ุงูุชุทููุฑ)

---

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู:

### 1. ุงููุตูู ููุตูุญุฉ:
- ุงูุชุญ ุงูุณุงูุฏ ุจุงุฑ
- ุงุถุบุท ุนูู "๐ ูุจูุนุงุช ุจูู ุงูุดุฑูุงุช"
- ุฃู ุงูุชูู ูุจุงุดุฑุฉ ุฅูู `/inter-company-sales`

### 2. ุฅูุดุงุก ูุงุชูุฑุฉ ุฌุฏูุฏุฉ:
```
1. ุงุถุบุท "โ ุฅูุดุงุก ูุงุชูุฑุฉ ุฌุฏูุฏุฉ"
2. ุงุฎุชุฑ ุงูุนููู (ุงุฎุชูุงุฑู)
3. ุงุฎุชุฑ ููุน ุงูุจูุน (ููุฏู/ุขุฌู)
4. ุฅุฐุง ูุงู ููุฏูุ ุงุฎุชุฑ ุทุฑููุฉ ุงูุฏูุน
5. ุงุถุบุท "โ ุฅุถุงูุฉ ุตูู"
6. ุงุฎุชุฑ ุงูุตูู ูู ุงููุงุฆูุฉ
7. ุฃุฏุฎู ุงููููุฉ
8. ุณูุชู ููุก ุณุนุฑ ุงูุดุฑูุฉ ุงูุฃู ุชููุงุฆูุงู
9. ุณูุชู ููุก ุณุนุฑ ุงููุฑุน ุจู 20% ุฒูุงุฏุฉ (ูุงุจู ููุชุนุฏูู)
10. ูุฑุฑ ุงูุฎุทูุงุช 5-9 ูุฅุถุงูุฉ ุงููุฒูุฏ ูู ุงูุฃุตูุงู
11. ุฑุงุฌุน ุงูุฅุฌูุงููุงุช ูู ุงูุฃุณูู
12. ุงุถุบุท "ุฅูุดุงุก ุงููุงุชูุฑุฉ"
```

### 3. ุนุฑุถ ุงูุชูุงุตูู:
```
1. ูู ุฌุฏูู ุงูููุงุชูุฑ
2. ุงุถุบุท ุฒุฑ "๐๏ธ" ุจุฌุงูุจ ุฃู ูุงุชูุฑุฉ
3. ุณุชุธูุฑ ุชูุงุตูู ุงููุงุชูุฑุฉ
```

---

## ๐ก ุงููููุฒุงุช ุงูุฐููุฉ:

### 1. **ููุก ุชููุงุฆู ููุฃุณุนุงุฑ**:
ุนูุฏ ุงุฎุชูุงุฑ ุตูู:
- ูุชู ููุก ุณุนุฑ ุงูุดุฑูุฉ ุงูุฃู ุชููุงุฆูุงู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ูุชู ููุก ุณุนุฑ ุงููุฑุน ุจู 20% ุฒูุงุฏุฉ ุงูุชุฑุงุถูุฉ
- ูููู ุชุนุฏูู ุณุนุฑ ุงููุฑุน ุญุณุจ ุงูุญุงุฌุฉ

### 2. **ุญุณุงุจ ุชููุงุฆู**:
- ุงูุฅุฌูุงูู ุงููุฑุนู = ุงููููุฉ ร ุณุนุฑ ุงููุฑุน
- ุงูุฅูุฑุงุฏุงุช = ูุฌููุน ุฌููุน ุงูุฅุฌูุงููุงุช ุงููุฑุนูุฉ
- ุงูุชูููุฉ = ูุฌููุน (ุงููููุฉ ร ุณุนุฑ ุงูุดุฑูุฉ ุงูุฃู)
- ุงูุฑุจุญ = ุงูุฅูุฑุงุฏุงุช - ุงูุชูููุฉ
- ูุณุจุฉ ูุงูุด ุงูุฑุจุญ = (ุงูุฑุจุญ / ุงูุฅูุฑุงุฏุงุช) ร 100

### 3. **ุชุญูู ูู ุงูุจูุงูุงุช**:
- ูุง ูููู ุฅูุดุงุก ูุงุชูุฑุฉ ุจุฏูู ุฃุตูุงู
- ุฌููุน ุงูุญููู ุงููุทููุจุฉ ูุฌุจ ููุคูุง
- ุงููููุงุช ูุงูุฃุณุนุงุฑ ูุฌุจ ุฃู ุชููู ููุฌุจุฉ

### 4. **ุชุตููู ูุชุฌุงูุจ**:
- ูุนูู ุนูู ุฌููุน ุฃุญุฌุงู ุงูุดุงุดุงุช
- ุฌุฏุงูู ูุงุจูุฉ ููุชูุฑูุฑ ุงูุฃููู
- ููุฏุงูุฒ ูุชุฌุงูุจุฉ

---

## ๐ฏ ูุง ูุญุฏุซ ูู ุงูุฎูููุฉ:

ุนูุฏ ุฅูุดุงุก ูุงุชูุฑุฉุ ุงููุธุงู ูููู ุจู:

### 1. **ุฅูุดุงุก ูุงุชูุฑุฉ ุจูุน** (Sale):
```typescript
{
  companyId: branchCompanyId,      // ุงูุดุฑูุฉ ุงูุชุงุจุนุฉ
  customerId: customerId,          // ุงูุนููู ุงูููุงุฆู
  saleType: 'CASH' ุฃู 'CREDIT',
  total: revenue,                  // ุงูุฅูุฑุงุฏุงุช
  lines: [...]                     // ุงูุฃุตูุงู ุจุณุนุฑ ุงููุฑุน
}
```

### 2. **ุฅูุดุงุก ูุงุชูุฑุฉ ุดุฑุงุก ุขุฌูุฉ** (PurchaseFromParent):
```typescript
{
  branchCompanyId: branchCompanyId,  // ุงูุดุฑูุฉ ุงูุชุงุจุนุฉ
  parentCompanyId: parentCompanyId,  // ุงูุดุฑูุฉ ุงูุฃู
  total: cost,                       // ุงูุชูููุฉ
  isSettled: false,                  // ุขุฌูุฉ ุฏุงุฆูุงู
  lines: [...]                       // ุงูุฃุตูุงู ุจุณุนุฑ ุงูุฃู
}
```

### 3. **ุฎุตู ุงููุฎุฒูู** (Stock):
```typescript
// ูู ูุฎุฒูู ุงูุดุฑูุฉ ุงูุฃู
stock.boxes = stock.boxes - qty
```

---

## ๐ ูุซุงู ุนููู ูุงูู:

### ุงูุณููุงุฑูู:
**ูุฑุน ุทุฑุงุจูุณ** ูุจูุน ููุนููู **ูุญูุฏ ุฃุญูุฏ**:
- 10 ุตูุงุฏูู ุจูุงุท ุณูุฑุงููู
- 5 ุตูุงุฏูู ุจูุงุท ุญูุงูุงุช

### ุงูุจูุงูุงุช:
```
ุจูุงุท ุณูุฑุงููู:
  - ุณุนุฑ ุงูุดุฑูุฉ ุงูุฃู: 50 ุฏ.ู
  - ุณุนุฑ ุงููุฑุน: 60 ุฏ.ู
  - ุงููููุฉ: 10 ุตูุงุฏูู

ุจูุงุท ุญูุงูุงุช:
  - ุณุนุฑ ุงูุดุฑูุฉ ุงูุฃู: 80 ุฏ.ู
  - ุณุนุฑ ุงููุฑุน: 95 ุฏ.ู
  - ุงููููุฉ: 5 ุตูุงุฏูู
```

### ุงูุญุณุงุจุงุช:
```
ุงูุฅูุฑุงุฏุงุช:
  (10 ร 60) + (5 ร 95) = 600 + 475 = 1,075 ุฏ.ู

ุงูุชูููุฉ:
  (10 ร 50) + (5 ร 80) = 500 + 400 = 900 ุฏ.ู

ุงูุฑุจุญ:
  1,075 - 900 = 175 ุฏ.ู

ูุณุจุฉ ูุงูุด ุงูุฑุจุญ:
  (175 / 1,075) ร 100 = 16.28%
```

### ุงููุชูุฌุฉ:
- โ ูุงุชูุฑุฉ ุจูุน ููุญูุฏ ุฃุญูุฏ ุจูููุฉ 1,075 ุฏ.ู
- โ ูุงุชูุฑุฉ ุดุฑุงุก ุขุฌูุฉ ูู ุงูุดุฑูุฉ ุงูุฃู ุจูููุฉ 900 ุฏ.ู
- โ ูุฎุฒูู ุงูุดุฑูุฉ ุงูุฃู: -10 ุจูุงุท ุณูุฑุงูููุ -5 ุจูุงุท ุญูุงูุงุช
- โ ุฑุจุญ ุงููุฑุน: 175 ุฏ.ู (16.28%)

---

## ๐ง ุงูุชุฎุตูุต:

### 1. ุชุบููุฑ ูุณุจุฉ ูุงูุด ุงูุฑุจุญ ุงูุงูุชุฑุงุถูุฉ:
ูู ููู `page.tsx`ุ ุงูุณุทุฑ 65:
```typescript
newLines[index].branchUnitPrice = product.price.sellPrice * 1.2; // 20% markup
```
ุบูุฑ `1.2` ุฅูู ุงููุณุจุฉ ุงููุทููุจุฉ (ูุซูุงู `1.3` ูู 30%)

### 2. ุฅุถุงูุฉ ุญููู ุฅุถุงููุฉ:
ููููู ุฅุถุงูุฉ ุญููู ูุซู:
- ููุงุญุธุงุช ุงููุงุชูุฑุฉ
- ุชุงุฑูุฎ ุงูุชุณููู
- ุฑูู ุฃูุฑ ุงูุดุฑุงุก
- ุฎุตููุงุช

### 3. ุชุญุณูู ููุฏุงู ุงูุชูุงุตูู:
ุญุงููุงู ูุนุฑุถ ุฑุณุงูุฉ "ููุฏ ุงูุชุทููุฑ"ุ ููููู ุฅุถุงูุฉ:
- ุชูุงุตูู ุงููุงุชูุฑุชูู
- ุงูุฃุตูุงู ุงููุจุงุนุฉ
- ูุงูุด ุงูุฑุจุญ ููู ุตูู
- ุฃุฒุฑุงุฑ ุทุจุงุนุฉ

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ:

### 1. ุงูุดุฑูุงุช ุงูุชุงุจุนุฉ ููุท:
- ูุฐู ุงูููุฒุฉ ุชุนูู ููุท ููุดุฑูุงุช ุงูุชุงุจุนุฉ (ุงูุชู ููุง `parentId`)
- ุฅุฐุง ุญุงููุช ุดุฑูุฉ ุบูุฑ ุชุงุจุนุฉ ุงุณุชุฎุฏุงููุงุ ุณุชุธูุฑ ุฑุณุงูุฉ ุฎุทุฃ

### 2. ุงููุฎุฒูู ูู ุงูุดุฑูุฉ ุงูุฃู:
- ูุชู ุฎุตู ุงููุฎุฒูู ูู ุงูุดุฑูุฉ ุงูุฃูุ ููุณ ูู ุงููุฑุน
- ุชุฃูุฏ ูู ุชููุฑ ุงููุฎุฒูู ูู ุงูุดุฑูุฉ ุงูุฃู ูุจู ุงูุจูุน

### 3. ุงูููุงุชูุฑ ูู ุงูุดุฑูุฉ ุงูุฃู ุขุฌูุฉ ุฏุงุฆูุงู:
- ูุง ูููู ุชุบููุฑ ูุฐุง ุงูุณููู
- ุงููุฑุน ูุฏูุน ููุดุฑูุฉ ุงูุฃู ูุงุญูุงู

### 4. ุงูุฃุณุนุงุฑ:
- ุณุนุฑ ุงูุดุฑูุฉ ุงูุฃู ููุฌูุจ ูู ุฌุฏูู `CompanyProductPrice`
- ุชุฃูุฏ ูู ูุฌูุฏ ุฃุณุนุงุฑ ูุญุฏุฏุฉ ููุฃุตูุงู

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก:

### 1. "ูุฐู ุงูุดุฑูุฉ ููุณุช ุดุฑูุฉ ุชุงุจุนุฉ":
**ุงูุญู**: ุชุฃูุฏ ูู ุฃู ุงูุดุฑูุฉ ุงูุญุงููุฉ ููุง `parentId` ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### 2. "ุงููุฎุฒูู ุบูุฑ ูุงูู":
**ุงูุญู**: ุชุญูู ูู ูุฎุฒูู ุงูุดุฑูุฉ ุงูุฃู ููุตูู ุงููุทููุจ

### 3. "ูุง ุชูุฌุฏ ุฃุตูุงู":
**ุงูุญู**: ุชุฃูุฏ ูู ูุฌูุฏ ุฃุตูุงู ูู ุงูุดุฑูุฉ ุงูุฃู ูุน ุฃุณุนุงุฑ ูุญุฏุฏุฉ

### 4. ุงูุตูุญุฉ ูุง ุชุญูู:
**ุงูุญู**: 
- ุชุฃูุฏ ูู ุชุดุบูู ุงูุฎุงุฏู (`npm run dev` ูู ูุฌูุฏ server)
- ุชุฃูุฏ ูู ุชุดุบูู ุงูููุงููุช (`npm run dev` ูู ูุฌูุฏ client)
- ุชุญูู ูู console ููุฃุฎุทุงุก

---

## ๐ API Endpoints:

```
POST   /api/inter-company-sales
       - ุฅูุดุงุก ูุงุชูุฑุฉ ูุจูุนุงุช ุจูู ุงูุดุฑูุงุช
       - Body: { customerId?, saleType, paymentMethod?, lines }

GET    /api/inter-company-sales
       - ุฌูุจ ุฌููุน ุงูููุงุชูุฑ
       - Query: { page, limit, search, customerId, saleType, startDate, endDate }

GET    /api/inter-company-sales/stats
       - ุฌูุจ ุงูุฅุญุตุงุฆูุงุช
       - Response: { totalSales, totalRevenue, totalCost, totalProfit, profitMargin }

GET    /api/inter-company-sales/:id
       - ุฌูุจ ุชูุงุตูู ูุงุชูุฑุฉ ูุญุฏุฏุฉ
       - Response: { sale, parentPurchase, profitMargin }
```

---

## โ ูุงุฆูุฉ ุงูุชุญูู ุงูููุงุฆูุฉ:

- [x] Backend DTOs
- [x] Backend Service
- [x] Backend Controller
- [x] Backend Routes
- [x] Backend Integration
- [x] Frontend API
- [x] Redux Integration
- [x] Sidebar Link
- [x] Frontend Page
- [x] Stats Cards
- [x] Search & Filters
- [x] Sales Table
- [x] Create Modal
- [x] Product Lines
- [x] Auto Calculations
- [x] Validation
- [x] Error Handling
- [x] Loading States
- [x] Responsive Design
- [x] Arabic Support
- [x] Documentation

---

## ๐ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ:

**ูุธุงู ุงููุจูุนุงุช ุจูู ุงูุดุฑูุงุช ููุชูู 100%!**

โ **Backend ุฌุงูุฒ ูุฌููุน APIs ุชุนูู**
โ **Frontend ุฌุงูุฒ ูุน ูุงุฌูุฉ ูุณุชุฎุฏู ูุงููุฉ**
โ **ุงูุชูุงูู ูุน Redux ูุงูู**
โ **ุงูุณุงูุฏ ุจุงุฑ ูุญุฏุซ**
โ **ุงูุชูุซูู ุงููุงูู ูุชููุฑ**

---

**ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุงูุขู! ๐**

ุงูุชุญ ุงููุชุตูุญ ูุงูุชูู ุฅูู `/inter-company-sales` ูุงุจุฏุฃ ุงูุจูุน! ๐
