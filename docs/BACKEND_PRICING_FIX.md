# ุฅุตูุงุญ ุฅุฑุณุงู ุงูุฃุณุนุงุฑ ููู Backend

## ๐ฏ ุงููุดููุฉ

ุนูุฏ **ุฅูุดุงุก ุงููุงุชูุฑุฉ** ูู Frontend:
- ุฎุงูุฉ ุงูุณุนุฑ: ุชุนุฑุถ ุณุนุฑ ุงููุชุฑ (120.50 ุฏ.ู/ูยฒ) โ
- ุงููุฌููุน: ูุญุณุจ ุจุงูุฃูุชุงุฑ (30 ร 120.50 = 3,615 ุฏ.ู) โ

ููู ุนูุฏ **ุฅุชูุงู ุงููุงุชูุฑุฉ** (ุฅุฑุณุงู ููู Backend):
- ุงูุจูุงูุงุช ุงูููุฑุณูุฉ: `qty: 5, unitPrice: 120.50`
- Backend ูุญุณุจ: `5 ร 120.50 = 602.50` โ (ุฎุทุฃ!)
- ุงูููุฑูุถ: `30 ร 120.50 = 3,615` โ

## ๐๏ธ ุงูุญู ุงููุทุจู

### ูุจู ุงูุฅุฑุณุงู ููู Backendุ ูุญูู ุงูุฃุณุนุงุฑ:

```typescript
// ุชุญููู ุงูุฃุณุนุงุฑ ููู Backend: ููุตูุงุฏูู ูุถุฑุจ ูู ุนุฏุฏ ุงูุฃูุชุงุฑ
const processedLines = saleForm.lines.map(line => {
  const product = productsData?.data?.products?.find(p => p.id === line.productId);
  
  if (product?.unit === 'ุตูุฏูู' && product.unitsPerBox) {
    // ููุตูุงุฏูู: ุงูุณุนุฑ ุงูููุงุฆู = ุณุนุฑ ุงููุชุฑ ร ุนุฏุฏ ุงูุฃูุชุงุฑ ูู ุงูุตูุฏูู
    return {
      ...line,
      unitPrice: line.unitPrice * Number(product.unitsPerBox)
    };
  }
  
  // ูููุญุฏุงุช ุงูุฃุฎุฑู: ุงูุณุนุฑ ูุจูู ููุง ูู
  return line;
});
```

## ๐ ูุซุงู ุนููู

### ุจูุงุท ุณูุฑุงููู ุฃุจูุถ 60ร60:
- **ุนุฏุฏ ุงูุฃูุชุงุฑ ูู ุงูุตูุฏูู**: 6 ูยฒ
- **ุงููููุฉ ุงููุฏุฎูุฉ**: 5 ุตูุงุฏูู
- **ุงูุณุนุฑ ุงููุนุฑูุถ**: 120.50 ุฏ.ู/ูยฒ

### ุงูุจูุงูุงุช ูู Frontend:
```javascript
line = {
  qty: 5,           // ุนุฏุฏ ุงูุตูุงุฏูู
  unitPrice: 120.50 // ุณุนุฑ ุงููุชุฑ
}
```

### ุงูุจูุงูุงุช ุงูููุฑุณูุฉ ููู Backend:
```javascript
processedLine = {
  qty: 5,           // ุนุฏุฏ ุงูุตูุงุฏูู
  unitPrice: 723    // ุณุนุฑ ุงูุตูุฏูู (120.50 ร 6)
}
```

### ุงููุชูุฌุฉ ูู Backend:
```
ุงููุฌููุน = 5 ร 723 = 3,615 ุฏ.ู โ
```

## ๐ง ุงููููุงุช ุงููุนุฏูุฉ

### 1. ุงููุจูุนุงุช ุงูุนุงุฏูุฉ:
**ุงูููู**: `/client/src/app/sales/page.tsx`
```typescript
// ูู ุฏุงูุฉ handleCreateSale
const processedLines = saleForm.lines.map(line => {
  const product = productsData?.data?.products?.find(p => p.id === line.productId);
  
  if (product?.unit === 'ุตูุฏูู' && product.unitsPerBox) {
    return {
      ...line,
      unitPrice: line.unitPrice * Number(product.unitsPerBox)
    };
  }
  
  return line;
});

const saleRequest = {
  ...saleForm,
  lines: processedLines,
  companyId: targetCompanyId
};
```

### 2. ููุงุชูุฑ ุงูุดุฑูุงุช ุงููุชุฑุงุจุทุฉ:
**ุงูููู**: `/client/src/app/inter-company-sales/page.tsx`
```typescript
// ูู ุฏุงูุฉ handleSubmit
const processedLines = lines.map(line => {
  const product = productsData?.data?.products?.find((p: any) => p.id === line.productId);
  
  if (product?.unit === 'ุตูุฏูู' && product.unitsPerBox) {
    return {
      ...line,
      parentUnitPrice: line.parentUnitPrice * Number(product.unitsPerBox),
      branchUnitPrice: line.branchUnitPrice * Number(product.unitsPerBox)
    };
  }
  
  return line;
});

await createSale({
  customerId,
  saleType,
  paymentMethod: saleType === 'CASH' ? paymentMethod : undefined,
  lines: processedLines
}).unwrap();
```

## โ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

### ูู Frontend (ูููุณุชุฎุฏู):
- **ุฎุงูุฉ ุงูุณุนุฑ**: 120.50 ุฏ.ู/ูยฒ (ูุงุถุญ ูููููู)
- **ุงููุฌููุน**: 3,615 ุฏ.ู (ุตุญูุญ)

### ูู Backend (ููุญุณุงุจุงุช):
- **ุงูุจูุงูุงุช ุงููุณุชููุฉ**: `qty: 5, unitPrice: 723`
- **ุงูุญุณุงุจ**: `5 ร 723 = 3,615 ุฏ.ู` (ุตุญูุญ)
- **ูุงุนุฏุฉ ุงูุจูุงูุงุช**: ุชุญูุธ ุงูุจูุงูุงุช ุจุดูู ุตุญูุญ

## ๐งช ุงุฎุชุจุงุฑ ุงูุฅุตูุงุญ

### ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ:
1. ุฃูุดุฆ ูุงุชูุฑุฉ ูุจูุนุงุช ุฌุฏูุฏุฉ
2. ุฃุถู ุตูู ุจูุญุฏุฉ "ุตูุฏูู" (ูุซู: ุจูุงุท ุณูุฑุงููู)
3. ุฃุฏุฎู ุงููููุฉ: 5 ุตูุงุฏูู
4. **ุชุญูู**: ุงูุณุนุฑ ุงููุนุฑูุถ = 120.50 ุฏ.ู/ูยฒ
5. **ุชุญูู**: ุงููุฌููุน ุงููุนุฑูุถ = 3,615 ุฏ.ู
6. **ุงุถุบุท "ุฅูุดุงุก ุงููุงุชูุฑุฉ"**
7. **ุชุญูู**: ุงููุงุชูุฑุฉ ุงููุญููุธุฉ ุชุญุชูู ุนูู ุงููุฌููุน ุงูุตุญูุญ

### ุงููุชูุฌุฉ ุงููุชููุนุฉ:
- โ Frontend ูุนุฑุถ ุงูุฃุณุนุงุฑ ุจุงููุชุฑ
- โ Backend ูุณุชูู ุงูุฃุณุนุงุฑ ุจุงูุตูุฏูู
- โ ุงูุญุณุงุจุงุช ุตุญูุญุฉ ูู ูู ููุงู
- โ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุชุญูุธ ุงูุจูุงูุงุช ุงูุตุญูุญุฉ

## ๐ ููุงุญุธุงุช ูููุฉ

### ูููุญุฏุงุช ุงูุฃุฎุฑู (ููุณุ ูุทุนุฉุ ูุชุฑ):
- **ูุง ุชุญููู**: ุงูุฃุณุนุงุฑ ุชูุฑุณู ููุง ูู
- **ุงูุณุจุจ**: ูุฐู ุงููุญุฏุงุช ูุง ุชุญุชุงุฌ ุชุญููู

### ููุตูุงุฏูู ููุท:
- **ุชุญููู**: ุณุนุฑ ุงููุชุฑ โ ุณุนุฑ ุงูุตูุฏูู
- **ุงูุตูุบุฉ**: `ุณุนุฑ ุงูุตูุฏูู = ุณุนุฑ ุงููุชุฑ ร ุนุฏุฏ ุงูุฃูุชุงุฑ`

---

**ุชุงุฑูุฎ ุงูุฅุตูุงุญ**: ุฃูุชูุจุฑ 2025  
**ุงูุญุงูุฉ**: ูุทุจู โ  
**ุงููุชูุฌุฉ**: Frontend ูุนุฑุถ ุจุงููุชุฑุ Backend ูุญุณุจ ุจุงูุตูุฏูู
