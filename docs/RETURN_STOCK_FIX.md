# โ ุฅุตูุงุญ ุฅุฑุฌุงุน ุงููููุงุช ูููุฎุฒูู

## ๐ ุงููุดููุฉ:

ุนูุฏ ุงุนุชูุงุฏ ุงููุฑุฏูุฏุงุชุ ูุงู ุงููุธุงู ูููู **ุจุชุนุฏูู ุงููููุฉ** ูู ุงููุฎุฒูู ุฅูู ุงููููุฉ ุงููุฑุฌุนุฉ ููุทุ ุจุฏูุงู ูู **ุฅุถุงูุฉ** ุงููููุฉ ุงููุฑุฌุนุฉ ุฅูู ุงููุฎุฒูู ุงูููุฌูุฏ.

### ูุซุงู ุนูู ุงููุดููุฉ:
```
ุงููุฎุฒูู ุงูุญุงูู: 100 ุตูุฏูู
ุงููููุฉ ุงููุฑุฌุนุฉ: 10 ุตูุงุฏูู

โ ุฎุทุฃ (ูุจู ุงูุฅุตูุงุญ):
ุงููุฎุฒูู ุจุนุฏ ุงูุงุนุชูุงุฏ = 10 ุตูุฏูู ููุท

โ ุตุญูุญ (ุจุนุฏ ุงูุฅุตูุงุญ):
ุงููุฎุฒูู ุจุนุฏ ุงูุงุนุชูุงุฏ = 110 ุตูุฏูู
```

---

## ๐ง ุงูุญู:

ุชู ุชุบููุฑ ุทุฑููุฉ ุชุญุฏูุซ ุงููุฎุฒูู ูู ุงุณุชุฎุฏุงู `increment` (ุงูุฐู ูุฏ ูุง ูุนูู ุจุดูู ุตุญูุญ ูุน ููุน `Decimal` ูู Prisma) ุฅูู **ุฅุถุงูุฉ ุตุฑูุญุฉ**:

### ุงูููุฏ ุงููุฏูู (ุงููุดููุฉ):
```typescript
await tx.stock.update({
  where: { id: stock.id },
  data: {
    boxes: {
      increment: line.qty  // ูุฏ ูุง ูุนูู ุจุดูู ุตุญูุญ ูุน Decimal
    }
  }
});
```

### ุงูููุฏ ุงูุฌุฏูุฏ (ุงูุญู):
```typescript
// ุฅุถุงูุฉ ุงููููุฉ ุงููุฑุฌุนุฉ ุฅูู ุงููุฎุฒูู ุงูููุฌูุฏ
const currentBoxes = Number(stock.boxes);
const returnedQty = Number(line.qty);
const newBoxes = currentBoxes + returnedQty;

console.log(`๐ฆ ุฅุฑุฌุงุน ูุฎุฒูู - ุงูููุชุฌ: ${line.productId}, ุงููููุฉ ุงูุญุงููุฉ: ${currentBoxes}, ุงููููุฉ ุงููุฑุฌุนุฉ: ${returnedQty}, ุงููููุฉ ุงูุฌุฏูุฏุฉ: ${newBoxes}`);

await tx.stock.update({
  where: { id: stock.id },
  data: {
    boxes: newBoxes
  }
});
```

---

## โจ ุงููููุฒุงุช ุงูุฌุฏูุฏุฉ:

### 1. **ุฅุถุงูุฉ ุตุฑูุญุฉ**:
- ุชุญููู ุงูุฃุฑูุงู ูู `Decimal` ุฅูู `Number`
- ุญุณุงุจ ุงููููุฉ ุงูุฌุฏูุฏุฉ ุจุดูู ูุงุถุญ
- ุชุญุฏูุซ ุงููุฎุฒูู ุจุงููููุฉ ุงููุญุณูุจุฉ

### 2. **Logging ููุตูู**:
```
๐ฆ ุฅุฑุฌุงุน ูุฎุฒูู - ุงูููุชุฌ: 15
   ุงููููุฉ ุงูุญุงููุฉ: 100
   ุงููููุฉ ุงููุฑุฌุนุฉ: 10
   ุงููููุฉ ุงูุฌุฏูุฏุฉ: 110
```

### 3. **ุงูุฅุฑุฌุงุน ูููุฎุฒูู ุงูุตุญูุญ**:
- ุฅุฐุง ูุงู ุงูููุชุฌ ูู **ุงูุชูุงุฒู** โ ููุฑุฌุน ููุฎุฒูู ุงูุชูุงุฒู
- ุฅุฐุง ูุงู ุงูููุชุฌ ูู **ุงูุฅูุงุฑุงุช** โ ููุฑุฌุน ููุฎุฒูู ุงูุฅูุงุฑุงุช

---

## ๐ฏ ููู ูุนูู ุงูุขู:

### **ุนูุฏ ุงุนุชูุงุฏ ูุฑุฏูุฏ:**

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 1. ุฌูุจ ุชูุงุตูู ุงููุฑุฏูุฏ                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 2. ููู ููุชุฌ ูู ุงููุฑุฏูุฏ:                โ
โ    - ุชุญุฏูุฏ ุงูุดุฑูุฉ ุงูููุดุฆุฉ ููููุชุฌ       โ
โ    - ุงูุจุญุซ ุนู ุงููุฎุฒูู ูู ุชูู ุงูุดุฑูุฉ   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 3. ุฅุฐุง ููุฌุฏ ุงููุฎุฒูู:                   โ
โ    ุงููููุฉ ุงูุฌุฏูุฏุฉ = ุงูุญุงููุฉ + ุงููุฑุฌุนุฉ  โ
โ    ุชุญุฏูุซ ุงููุฎุฒูู                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 4. ุฅุฐุง ูู ูููุฌุฏ ุงููุฎุฒูู:               โ
โ    ุฅูุดุงุก ุณุฌู ูุฎุฒูู ุฌุฏูุฏ                โ
โ    ุจุงููููุฉ ุงููุฑุฌุนุฉ                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ูุซุงู ุนููู:

### **ุงูุณููุงุฑูู:**
```
ูุงุชูุฑุฉ ูุฎุชูุทุฉ ูู ุงูุฅูุงุฑุงุช:
- 50 ุตูุฏูู ุจูุงุท ูู ุงูุชูุงุฒู
- 30 ุตูุฏูู ุณูุฑุงููู ูู ุงูุฅูุงุฑุงุช
```

### **ุงููุฎุฒูู ูุจู ุงููุฑุฏูุฏ:**
```
ุงูุชูุงุฒู:
  - ุจูุงุท: 100 ุตูุฏูู

ุงูุฅูุงุฑุงุช:
  - ุณูุฑุงููู: 80 ุตูุฏูู
```

### **ุนูููุฉ ุงููุฑุฏูุฏ:**
```
ุฑุฏ 10 ุตูุงุฏูู ุจูุงุท + 5 ุตูุงุฏูู ุณูุฑุงููู
```

### **ุงููุฎุฒูู ุจุนุฏ ุงุนุชูุงุฏ ุงููุฑุฏูุฏ:**

#### โ **ูุจู ุงูุฅุตูุงุญ (ุฎุทุฃ):**
```
ุงูุชูุงุฒู:
  - ุจูุงุท: 10 ุตูุฏูู โ ุฎุทุฃ!

ุงูุฅูุงุฑุงุช:
  - ุณูุฑุงููู: 5 ุตูุฏูู โ ุฎุทุฃ!
```

#### โ **ุจุนุฏ ุงูุฅุตูุงุญ (ุตุญูุญ):**
```
ุงูุชูุงุฒู:
  - ุจูุงุท: 110 ุตูุฏูู โ (100 + 10) โ

ุงูุฅูุงุฑุงุช:
  - ุณูุฑุงููู: 85 ุตูุฏูู โ (80 + 5) โ
```

---

## ๐ ุงูุชุญูู ูู ุงูุนูููุฉ:

### **ูู ุฎูุงู Logs:**
ุนูุฏ ุงุนุชูุงุฏ ุฃู ูุฑุฏูุฏุ ุณุชุธูุฑ ุฑุณุงุฆู ูู console ุงูุฎุงุฏู:

```bash
๐ฆ ุฅุฑุฌุงุน ูุฎุฒูู - ุงูููุชุฌ: 15, ุงููููุฉ ุงูุญุงููุฉ: 100, ุงููููุฉ ุงููุฑุฌุนุฉ: 10, ุงููููุฉ ุงูุฌุฏูุฏุฉ: 110
๐ฆ ุฅุฑุฌุงุน ูุฎุฒูู - ุงูููุชุฌ: 23, ุงููููุฉ ุงูุญุงููุฉ: 80, ุงููููุฉ ุงููุฑุฌุนุฉ: 5, ุงููููุฉ ุงูุฌุฏูุฏุฉ: 85
```

### **ูู ุฎูุงู ูุงุฌูุฉ ุงููุฎุฒูู:**
1. ุงุฐูุจ ุฅูู **ุงููุฎุฒูู**
2. ุงุจุญุซ ุนู ุงูููุชุฌ ุงููุฑุฌุน
3. ุชุญูู ูู ุงููููุฉ - ูุฌุจ ุฃู ุชููู = ุงููุฏููุฉ + ุงููุฑุฌุนุฉ

---

## ๐ ุงูุงุฎุชุจุงุฑ:

### **ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ:**

1. **ุชุญูู ูู ุงููุฎุฒูู ุงูุญุงูู:**
   ```
   ุงูููุชุฌ: ุจูุงุท ุฃุจูุถ
   ุงููุฎุฒูู ุงูุญุงูู: 50 ุตูุฏูู
   ```

2. **ุฃูุดุฆ ูุฑุฏูุฏ:**
   ```
   ูุงุชูุฑุฉ: #100
   ุงูููุชุฌ: ุจูุงุท ุฃุจูุถ
   ุงููููุฉ ุงููุฑุฌุนุฉ: 10 ุตูุงุฏูู
   ```

3. **ุงุนุชูุฏ ุงููุฑุฏูุฏ:**
   - ุงุฐูุจ ุฅูู ุดุงุดุฉ ุงููุฑุฏูุฏุงุช
   - ุงุนุชูุฏ ุงููุฑุฏูุฏ

4. **ุชุญูู ูู ุงููุฎุฒูู ุงูุฌุฏูุฏ:**
   ```
   ุงูููุชุฌ: ุจูุงุท ุฃุจูุถ
   ุงููุฎุฒูู ุงูุฌุฏูุฏ: 60 ุตูุฏูู โ (50 + 10) โ
   ```

5. **ุฑุงุฌุน ุงูู Logs:**
   ```bash
   ๐ฆ ุฅุฑุฌุงุน ูุฎุฒูู - ุงูููุชุฌ: 15
      ุงููููุฉ ุงูุญุงููุฉ: 50
      ุงููููุฉ ุงููุฑุฌุนุฉ: 10
      ุงููููุฉ ุงูุฌุฏูุฏุฉ: 60
   ```

---

## ๐ฏ ุงูููุงุฆุฏ:

โ **ุฏูุฉ ุงููุฎุฒูู**: ุงููููุงุช ุชูุญุณุจ ุจุดูู ุตุญูุญ ุฏุงุฆูุงู
โ **ูุถูุญ ุงูุนูููุฉ**: Logging ูุธูุฑ ูู ุฎุทูุฉ ุจูุถูุญ
โ **ุณูููุฉ ุงูุชุชุจุน**: ูููู ุชุชุจุน ูู ุนูููุฉ ุฅุฑุฌุงุน
โ **ููุซูููุฉ ุฃุนูู**: ูุง ุงุนุชูุงุฏ ุนูู `increment` ูุน Decimal

---

## ๐ ููุงุญุธุงุช ุชูููุฉ:

### **ููุงุฐุง ุชู ุงูุชุบููุฑุ**
- Prisma's `increment` ูุฏ ูุง ูุนูู ุจุดูู ููุซูู ูุน ููุน `Decimal`
- ุงูุฅุถุงูุฉ ุงูุตุฑูุญุฉ ุฃูุซุฑ ูุถูุญุงู ููุงุจููุฉ ููุชุชุจุน
- ุงูุชุญููู ุฅูู `Number` ุซู ุงูุนูุฏุฉ ุฅูู `Decimal` ุฃูุซุฑ ุฃูุงูุงู

### **ููู ุงูููุฏ:**
`/server/src/services/SaleReturnService.ts`

**ุงูุฏุงูุฉ:**
`async approveSaleReturn(id: number, companyId: number)`

**ุงูุณุทูุฑ:**
332-346

---

## โ ุฌุงูุฒ ููุงุณุชุฎุฏุงู!

ุงููุธุงู ุงูุขู ูุถูู ุงููููุงุช ุจุดูู ุตุญูุญ ุฅูู ุงููุฎุฒูู ุนูุฏ ุงุนุชูุงุฏ ุงููุฑุฏูุฏุงุช! ๐

