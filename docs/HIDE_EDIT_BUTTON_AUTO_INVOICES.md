# ุฅุฏุงุฑุฉ ุฒุฑ ุงูุชุนุฏูู ูู ุงูููุงุชูุฑ

## ๐ฏ ุงููุฏู

1. โ **ุดุงุดุฉ ุงููุจูุนุงุช:** ุชุนุทูู ุฒุฑ "ุชุนุฏูู" (disabled) ููููุงุชูุฑ ุงูุชููุงุฆูุฉ (ููุงุชูุฑ ุงูุชูุงุฒู)
2. โ **ุดุงุดุฉ ุงููุญุงุณุจ:** ุฅุฒุงูุฉ ุฒุฑ "ุชุนุฏูู" ุชูุงูุงู (ูุฌููุน ุงูููุงุชูุฑ)

---

## ๐ ุงูุชุบููุฑุงุช

### 1. **ุฅุถุงูุฉ ุญูู `isAutoGenerated` ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช**

**ุงูููู:** `server/prisma/schema.prisma`

```prisma
model Sale {
  id                         Int               @id @default(autoincrement())
  companyId                  Int
  customerId                 Int?
  invoiceNumber              String?
  total                      Decimal           @default(0) @db.Decimal(18, 4)
  saleType                   SaleType?
  paymentMethod              PaymentMethod?
  createdAt                  DateTime          @default(now())
  isFullyPaid                Boolean           @default(false)
  paidAmount                 Decimal           @default(0) @db.Decimal(18, 4)
  remainingAmount            Decimal           @default(0) @db.Decimal(18, 4)
  receiptIssued              Boolean           @default(false)
  receiptIssuedAt            DateTime?
  receiptIssuedBy            String?
  approvedAt                 DateTime?
  approvedBy                 String?
  notes                      String?
  status                     SaleStatus        @default(DRAFT)
  updatedAt                  DateTime          @updatedAt
  isAutoGenerated            Boolean           @default(false) // โ ุฌุฏูุฏ
  relatedParentSaleId        Int?
  relatedBranchPurchaseId    Int?
  relatedPurchaseFromParentId Int?
  // ... ุจุงูู ุงูุญููู
}
```

**ุงูุชุทุจูู:**
```bash
npx prisma db push
```

---

### 2. **ุชุนููู `isAutoGenerated = true` ุนูุฏ ุฅูุดุงุก ูุงุชูุฑุฉ ุงูุชูุงุฒู**

**ุงูููู:** `server/src/services/ComplexInterCompanySaleService.ts`

**ุงูุณุทุฑ 290:**

```typescript
parentSale = await tx.sale.create({
  data: {
    companyId: data.parentCompanyId,
    customerId: branchAsCustomer.id, // ุงูุดุฑูุฉ ุงููุฑุนูุฉ ูุนููู
    invoiceNumber: `PR-${data.parentCompanyId}-${Date.now()}`,
    total: parentSaleTotal,
    saleType: 'CREDIT', // ุขุฌูุฉ ุฏุงุฆูุงู
    paymentMethod: 'CASH',
    paidAmount: 0,
    remainingAmount: parentSaleTotal,
    isFullyPaid: false,
    status: 'DRAFT', // ูุจุฏุฆูุฉ - ูู ุงูุชุธุงุฑ ุงุนุชูุงุฏ ุงููุญุงุณุจ
    isAutoGenerated: true, // โ ูุงุชูุฑุฉ ุชููุงุฆูุฉ - ูุง ูููู ุชุนุฏูููุง ูุจุงุดุฑุฉ
    lines: {
      create: parentCompanyLines.map(line => ({
        productId: line.productId,
        qty: line.qty,
        unitPrice: line.parentUnitPrice || 0,
        subTotal: line.qty * (line.parentUnitPrice || 0)
      }))
    }
  }
});
```

---

### 3. **ุฅุถุงูุฉ `isAutoGenerated` ุฅูู `Sale` Interface ูู ุงููุงุฌูุฉ**

**ุงูููู:** `client/src/state/salesApi.ts`

**ุงูุณุทุฑ 48:**

```typescript
export interface Sale {
  id: number;
  companyId: number;
  company: {
    id: number;
    name: string;
    code: string;
  };
  customerId?: number;
  customer?: {
    id: number;
    name: string;
    phone?: string;
  };
  invoiceNumber?: string;
  total: number;
  status: "DRAFT" | "APPROVED" | "CANCELLED"; // ุญุงูุฉ ุงููุงุชูุฑุฉ
  notes?: string; // ููุงุญุธุงุช
  isAutoGenerated?: boolean; // โ ูู ุชู ุฅูุดุงุคูุง ุชููุงุฆูุงู (ูุงุชูุฑุฉ ุงูุชูุงุฒู)ุ
  saleType?: "CASH" | "CREDIT"; // ูุญุฏุฏู ุงููุญุงุณุจ
  paymentMethod?: "CASH" | "BANK" | "CARD"; // ูุญุฏุฏู ุงููุญุงุณุจ
  // ... ุจุงูู ุงูุญููู
}
```

---

### 4. **ุชุนุทูู ุฒุฑ ุงูุชุนุฏูู ููููุงุชูุฑ ุงูุชููุงุฆูุฉ ูู ุดุงุดุฉ ุงููุจูุนุงุช**

**ุงูููู:** `client/src/app/sales/page.tsx`

**ุงูุณุทุฑ 1273:**

**ูุจู:**
```tsx
{sale.status === 'DRAFT' && (
  <button
    onClick={() => handleEditSale(sale)}
    className="text-orange-600 hover:text-orange-900 p-1 rounded"
    title="ุชุนุฏูู ุงููุงุชูุฑุฉ"
    disabled={isUpdating}
  >
    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
    </svg>
  </button>
)}
```

**ุจุนุฏ:**
```tsx
{sale.status === 'DRAFT' && (
  <button
    onClick={() => handleEditSale(sale)}
    className={`p-1 rounded ${sale.isAutoGenerated ? 'text-gray-400 cursor-not-allowed' : 'text-orange-600 hover:text-orange-900'}`}
    title={sale.isAutoGenerated ? 'ูุง ูููู ุชุนุฏูู ุงูููุงุชูุฑ ุงูุชููุงุฆูุฉ - ุนุฏูู ุงููุงุชูุฑุฉ ุงูุฃุตููุฉ' : 'ุชุนุฏูู ุงููุงุชูุฑุฉ'}
    disabled={isUpdating || sale.isAutoGenerated} // โ ูุนุทู ููููุงุชูุฑ ุงูุชููุงุฆูุฉ
  >
    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
    </svg>
  </button>
)}
```

**ุงูุชุบููุฑุงุช:**
- โ ุงูุฒุฑ ูุธูุฑ ุฏุงุฆูุงู ููููุงุชูุฑ ุงููุจุฏุฆูุฉ (DRAFT)
- โ ุงูููู ุฑูุงุฏู ูุงุชุญ (`text-gray-400`) ููููุงุชูุฑ ุงูุชููุงุฆูุฉ
- โ ุงููุคุดุฑ ูุชุบูุฑ ุฅูู `cursor-not-allowed` ููููุงุชูุฑ ุงูุชููุงุฆูุฉ
- โ `disabled={isUpdating || sale.isAutoGenerated}` - ูุนุทู ููููุงุชูุฑ ุงูุชููุงุฆูุฉ
- โ ุฑุณุงูุฉ tooltip ุชูุถุญ ุงูุณุจุจ ุนูุฏ ุงูุชูุฑูุฑ ุนูู ุงูุฒุฑ ุงููุนุทู

---

### 5. **ุฅุฒุงูุฉ ุฒุฑ ุงูุชุนุฏูู ุชูุงูุงู ูู ุดุงุดุฉ ุงููุญุงุณุจ**

**ุงูููู:** `client/src/app/accountant/page.tsx`

**ุงูุณุทุฑ 1057:**

**ูุจู:**
```tsx
) : sale.status === 'DRAFT' ? (
  <div className="flex gap-2">
    <button
      onClick={() => handleEditSale(sale)}
      disabled={isUpdating}
      className="inline-flex items-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 transition-colors"
      title="ุชุนุฏูู ุงููุงุชูุฑุฉ"
    >
      <svg className="h-4 w-4 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
      </svg>
      ุชุนุฏูู
    </button>
    <button
      onClick={() => handleApproveSale(sale)}
      disabled={isApproving}
      className="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 transition-colors"
    >
      <svg className="h-4 w-4 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      ุงุนุชูุงุฏ ุงููุงุชูุฑุฉ
    </button>
  </div>
```

**ุจุนุฏ:**
```tsx
) : sale.status === 'DRAFT' ? (
  <button
    onClick={() => handleApproveSale(sale)}
    disabled={isApproving}
    className="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 transition-colors"
  >
    <svg className="h-4 w-4 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
    </svg>
    ุงุนุชูุงุฏ ุงููุงุชูุฑุฉ
  </button>
```

---

## ๐ฏ ุงููุชูุฌุฉ

### โ ูุงุฐุง ูุญุฏุซ ุงูุขู:

#### 1. **ุดุงุดุฉ ุงููุจูุนุงุช:**

**ูุงุชูุฑุฉ ุนุงุฏูุฉ (ุบูุฑ ุชููุงุฆูุฉ):**
```
- isAutoGenerated: false
- ุงูุฃุฒุฑุงุฑ: [๐๏ธ ุนุฑุถ] [โ๏ธ ุชุนุฏูู โ] [๐๏ธ ุญุฐู]
- ุฒุฑ ุงูุชุนุฏูู: ูุดุท (ุจุฑุชูุงูู)
- ูููู ุงูุชุนุฏูู โ
```

**ูุงุชูุฑุฉ ุงูุชูุงุฒู (ุชููุงุฆูุฉ):**
```
- isAutoGenerated: true
- ุงูุฃุฒุฑุงุฑ: [๐๏ธ ุนุฑุถ] [โ๏ธ ุชุนุฏูู ๐] [๐๏ธ ุญุฐู]
- ุฒุฑ ุงูุชุนุฏูู: ูุนุทู (ุฑูุงุฏู) โ
- ุงููุคุดุฑ: cursor-not-allowed ๐ซ
- ุฑุณุงูุฉ Tooltip: "ูุง ูููู ุชุนุฏูู ุงูููุงุชูุฑ ุงูุชููุงุฆูุฉ - ุนุฏูู ุงููุงุชูุฑุฉ ุงูุฃุตููุฉ"
- ูุง ูููู ุงูุชุนุฏูู ูุจุงุดุฑุฉ โ
```

---

#### 2. **ุดุงุดุฉ ุงููุญุงุณุจ:**

**ุฌููุน ุงูููุงุชูุฑ (DRAFT):**
```
- ุงูุฃุฒุฑุงุฑ: [โ ุงุนุชูุงุฏ ุงููุงุชูุฑุฉ] ููุท
- ุฒุฑ "ุชุนุฏูู": ุชู ุฅุฒุงูุชู ุชูุงูุงู โ
- ุงูุชุนุฏูู ูุชู ูู ุดุงุดุฉ ุงููุจูุนุงุช ููุท
```

---

## ๐งช ุณููุงุฑูู ุงูุงุฎุชุจุงุฑ

### 1. **ุฅูุดุงุก ูุงุชูุฑุฉ ูุนูุฏุฉ:**

```
ุงููุณุชุฎุฏู (ุงูุฅูุงุฑุงุช) โ ููุดุฆ ูุงุชูุฑุฉ:
  - ุตูู ุงูุชูุงุฒู A: 10 ุตูุงุฏูู
  - ุตูู ุงูุฅูุงุฑุงุช B: 5 ุตูุงุฏูู

ุงููุธุงู ููุดุฆ 3 ููุงุชูุฑ:
  โ ูุงุชูุฑุฉ ุงูุฅูุงุฑุงุช (ุงูุนููู ุงูุฃุตูู)
     - isAutoGenerated: false
     - ุฒุฑ "ุชุนุฏูู": ุธุงูุฑ โ
  
  โ ูุงุชูุฑุฉ ุงูุชูุงุฒู (ููุฅูุงุฑุงุช ูุนููู)
     - isAutoGenerated: true
     - ุฒุฑ "ุชุนุฏูู": ูุฎูู โ
     - ุฒุฑ "ุงุนุชูุงุฏ": ุธุงูุฑ โ
  
  โ ูุงุชูุฑุฉ ุงููุดุชุฑูุงุช (ููุฅูุงุฑุงุช)
```

---

### 2. **ูู ุดุงุดุฉ ุงููุจูุนุงุช:**

```
ุงููุงุชูุฑุฉ ุงูุนุงุฏูุฉ:
  - ุงูุนููู: ูุญูุฏ
  - ุงูุญุงูุฉ: DRAFT
  - ุงูุฃุฒุฑุงุฑ: ุนุฑุถ | ุชุนุฏูู โ (ุจุฑุชูุงูู) | ุญุฐู

ูุงุชูุฑุฉ ุงูุชูุงุฒู:
  - ุงูุนููู: ุงูุฅูุงุฑุงุช
  - ุงูุญุงูุฉ: DRAFT
  - ุงูุฃุฒุฑุงุฑ: ุนุฑุถ | ุชุนุฏูู ๐ (ุฑูุงุฏู ูุนุทู) | ุญุฐู
  - ุนูุฏ ุงูุชูุฑูุฑ ุนูู ุฒุฑ ุงูุชุนุฏูู:
    ๐ฌ "ูุง ูููู ุชุนุฏูู ุงูููุงุชูุฑ ุงูุชููุงุฆูุฉ - ุนุฏูู ุงููุงุชูุฑุฉ ุงูุฃุตููุฉ"
```

---

### 3. **ูู ุดุงุดุฉ ุงููุญุงุณุจ:**

```
ุฌููุน ุงูููุงุชูุฑ:
  - ุงูุญุงูุฉ: DRAFT
  - ุงูุฃุฒุฑุงุฑ: [โ ุงุนุชูุงุฏ ุงููุงุชูุฑุฉ] ููุท
  - ุฒุฑ ุงูุชุนุฏูู: ุชู ุฅุฒุงูุชู ุชูุงูุงู โ
  
ููุงุญุธุฉ: ุงูุชุนุฏูู ูุชู ูู ุดุงุดุฉ ุงููุจูุนุงุช ููุทุ ูุงููุญุงุณุจ ูุนุชูุฏ ููุท
```

---

### 4. **ูุญุงููุฉ ุงูุชุนุฏูู ุงููุจุงุดุฑุฉ (ูู ุงูู API):**

```
ุฅุฐุง ุญุงูู ุงููุณุชุฎุฏู ุชุนุฏูู ูุงุชูุฑุฉ ุงูุชูุงุฒู ูุจุงุดุฑุฉ ูู ุงูู API:

โ ุฎุทุฃ 403 Forbidden:

"โ ูุง ูููู ุชุนุฏูู ูุฐู ุงููุงุชูุฑุฉ ูุจุงุดุฑุฉ!

ูุฐู ูุงุชูุฑุฉ ุชู ุฅูุดุงุคูุง ุชููุงุฆูุงู ูู ูุงุชูุฑุฉ ูุนูุฏุฉ.

๐ ุงููุงุชูุฑุฉ ุงูุฃุตููุฉ: #5
๐ค ุงูุนููู: ูุญูุฏ

๐ก ูุชุนุฏูู ูุฐู ุงููุงุชูุฑุฉุ ุงุฐูุจ ุฅูู ุงููุงุชูุฑุฉ ุงูุฃุตููุฉ ูุนุฏูููุง."
```

---

## ๐ก ููุงุญุธุงุช ูููุฉ

### 1. **ุชูุฑูู ุงูุตูุงุญูุงุช:**
```
โ ุดุงุดุฉ ุงููุจูุนุงุช: 
   - ุงูุชุนุฏูู ูุชุงุญ (ุฅูุง ููููุงุชูุฑ ุงูุชููุงุฆูุฉ)
   - ุงูุญุฐู ูุชุงุญ

โ ุดุงุดุฉ ุงููุญุงุณุจ:
   - ุงูุชุนุฏูู: ุบูุฑ ูุชุงุญ โ
   - ุงูุงุนุชูุงุฏ: ูุชุงุญ โ
   - ุฅุตุฏุงุฑ ุฅูุตุงู ุงููุจุถ: ูุชุงุญ โ
```

### 2. **ุงูุญูุงูุฉ ุนูู ูุณุชูููู:**
```
โ ูุณุชูู ุงููุงุฌูุฉ: 
   - ุฒุฑ ุงูุชุนุฏูู ูุฎูู ููููุงุชูุฑ ุงูุชููุงุฆูุฉ (ุดุงุดุฉ ุงููุจูุนุงุช)
   - ุฒุฑ ุงูุชุนุฏูู ุบูุฑ ููุฌูุฏ (ุดุงุดุฉ ุงููุญุงุณุจ)

โ ูุณุชูู ุงูู API: 
   - ุฑูุถ ุงูุชุนุฏูู ุงููุจุงุดุฑ ููููุงุชูุฑ ุงูุชููุงุฆูุฉ
   - ุฑุณุงูุฉ ุฎุทุฃ ูุงุถุญุฉ (403 Forbidden)
```

### 3. **ุงูุชุนุฏูู ุงูุชููุงุฆู:**
```
ุนูุฏ ุชุนุฏูู ุงููุงุชูุฑุฉ ุงูุฃุตููุฉ โ ูุงุชูุฑุฉ ุงูุชูุงุฒู ุชูุญุฏูุซ ุชููุงุฆูุงู
ูุง ุญุงุฌุฉ ููุชุนุฏูู ุงููุฏูู ุนูู ูุงุชูุฑุฉ ุงูุชูุงุฒู
```

### 4. **ุฒุฑ ุงูุงุนุชูุงุฏ:**
```
ุฒุฑ "ุงุนุชูุงุฏ ุงููุงุชูุฑุฉ" ููุฌูุฏ ูุฌููุน ุงูููุงุชูุฑ (DRAFT) ูู ุดุงุดุฉ ุงููุญุงุณุจ
ุณูุงุก ูุงูุช ูุงุชูุฑุฉ ุนุงุฏูุฉ ุฃู ูุงุชูุฑุฉ ุชูุงุฒู ุชููุงุฆูุฉ
```

---

## ๐ ุงููููุงุช ุงููุนุฏูุฉ

```
โ server/prisma/schema.prisma
   - ุฅุถุงูุฉ isAutoGenerated: Boolean @default(false)

โ server/src/services/ComplexInterCompanySaleService.ts
   - ุชุนููู isAutoGenerated: true ููุงุชูุฑุฉ ุงูุชูุงุฒู

โ client/src/state/salesApi.ts
   - ุฅุถุงูุฉ isAutoGenerated?: boolean ุฅูู Sale interface

โ client/src/app/sales/page.tsx
   - ุชุนุทูู ุฒุฑ ุงูุชุนุฏูู ููููุงุชูุฑ ุงูุชููุงุฆูุฉ:
     * disabled={isUpdating || sale.isAutoGenerated}
     * className: ุชุบููุฑ ุงูููู ุญุณุจ ุงูุญุงูุฉ (ุจุฑุชูุงูู/ุฑูุงุฏู)
     * title: ุฑุณุงูุฉ ุชูุถูุญูุฉ ููููุงุชูุฑ ุงููุนุทูุฉ

โ client/src/app/accountant/page.tsx
   - ุฅุฒุงูุฉ ุฒุฑ ุงูุชุนุฏูู ุชูุงูุงู (ูุฌููุน ุงูููุงุชูุฑ)
```

---

## ๐ ุญุงูุฉ ุงููุธุงู

```
โ ุฅูุดุงุก ูุงุชูุฑุฉ: DRAFT ุจุฏูู ุฎุตู ูุฎุฒูู
โ ุงุนุชูุงุฏ ูุงุชูุฑุฉ: APPROVED + ุฎุตู ูุฎุฒูู
โ ุชุนุฏูู ูุงุชูุฑุฉ ุนุงุฏูุฉ (ูู ุงููุจูุนุงุช): ูุนูู
โ ุชุนุฏูู ูุงุชูุฑุฉ ุชููุงุฆูุฉ: ูุญุธูุฑ (ูุงุฌูุฉ + API)
โ ุฒุฑ ุงูุชุนุฏูู ูู ุดุงุดุฉ ุงููุจูุนุงุช:
   - ูุงุชูุฑุฉ ุนุงุฏูุฉ: ูุดุท (ุจุฑุชูุงูู) โ
   - ูุงุชูุฑุฉ ุชููุงุฆูุฉ: ูุนุทู (ุฑูุงุฏู + tooltip) ๐
โ ุฒุฑ ุงูุชุนุฏูู ูู ุดุงุดุฉ ุงููุญุงุณุจ: ุชู ุฅุฒุงูุชู ุชูุงูุงู โ
โ ุฒุฑ ุงูุงุนุชูุงุฏ ูู ุดุงุดุฉ ุงููุญุงุณุจ: ุธุงูุฑ ูุฌููุน ุงูููุงุชูุฑ โ
โ ุญุฐู ูุงุชูุฑุฉ ูุนูุฏุฉ: ุญุฐู ูุชุณูุณู
โ ุงูุชุญุฏูุซ ุงูุชููุงุฆู ูููุงุชูุฑุฉ ุงูุชูุงุฒู ุนูุฏ ุชุนุฏูู ุงูุฃุตููุฉ
โ ุงูุฎุงุฏู: ูุนูู ุนูู ุงููููุฐ 4000
```

---

**ุชุงุฑูุฎ ุงูุชุญุฏูุซ:** 5 ููููุจุฑ 2025  
**ุงูุญุงูุฉ:** โ ููุทุจูู ููุนูู  
**ุงูุชุฃุซูุฑ:** 
- ๐ก๏ธ ููุน ุงูุชุนุฏูู ุงููุจุงุดุฑ ุนูู ุงูููุงุชูุฑ ุงูุชููุงุฆูุฉ (disabled + tooltip)
- ๐จ ุชุญุณูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู (ุงูุฒุฑ ูุนุทู ุจุดูู ูุงุถุญุ ููุณ ูุฎูู)
- ๐ฌ ุฑุณุงูุฉ ุชูุถูุญูุฉ ุนูุฏ ุงูุชูุฑูุฑ ุนูู ุงูุฒุฑ ุงููุนุทู

