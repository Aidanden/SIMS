#!/bin/bash

echo "๐ ุจุฏุก ุชุทุจูู ููุฒุฉ ุงูุญุฐู ุงููุชุณูุณู ููููุงุชูุฑ ุงููุนูุฏุฉ..."
echo "======================================================="

cd "$(dirname "$0")/server"

echo ""
echo "๐ ุงูุฎุทูุฉ 1: ุชุทุจูู migration ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช..."
echo "---------------------------------------------------"
psql "$DATABASE_URL" -f prisma/migrations/add_related_sale_fields.sql

if [ $? -eq 0 ]; then
    echo "โ ุชู ุชุทุจูู migration ุจูุฌุงุญ"
else
    echo "โ ูุดู ุชุทุจูู migration"
    echo "๐ก ููููู ุชุทุจููู ูุฏููุงู ุจุงุณุชุฎุฏุงู:"
    echo "   psql \$DATABASE_URL -f server/prisma/migrations/add_related_sale_fields.sql"
    echo ""
    echo "ุฃู ุงุณุชุฎุฏุงู Prisma:"
    echo "   cd server && npx prisma db push"
fi

echo ""
echo "๐ ุงูุฎุทูุฉ 2: ุชุญุฏูุซ Prisma Client..."
echo "---------------------------------------------------"
npx prisma generate

if [ $? -eq 0 ]; then
    echo "โ ุชู ุชุญุฏูุซ Prisma Client ุจูุฌุงุญ"
else
    echo "โ ูุดู ุชุญุฏูุซ Prisma Client"
    exit 1
fi

echo ""
echo "๐ ุงูุฎุทูุฉ 3: ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุงุฏู..."
echo "---------------------------------------------------"
echo "โ๏ธ  ูุฑุฌู ุฅุนุงุฏุฉ ุชุดุบูู ุฎุงุฏู Backend ูุฏููุงู:"
echo "   cd server && npm run dev"

echo ""
echo "โ ุชู ุชุทุจูู ุฌููุน ุงูุชุญุฏูุซุงุช ุจูุฌุงุญ!"
echo "======================================================="
echo ""
echo "๐ ููุฎุต ุงูุชุบููุฑุงุช:"
echo "  โ ุฅุถุงูุฉ ุญููู ุงูุฑุจุท ูู ุฌุฏูู Sale"
echo "  โ ุฅุถุงูุฉ ุญููู ุงูุฑุจุท ูู ุฌุฏูู Purchase"
echo "  โ ุฅุถุงูุฉ ุญููู ุงูุฑุจุท ูู ุฌุฏูู PurchaseFromParent"
echo "  โ ุชุญุฏูุซ ComplexInterCompanySaleService ูุญูุธ ูุนูููุงุช ุงูุฑุจุท"
echo "  โ ุชุญุฏูุซ deleteSale ููุญุฐู ุงููุชุณูุณู"
echo ""
echo "๐ฏ ุงูุขู ุนูุฏ ุญุฐู ูุงุชูุฑุฉ ูุนูุฏุฉุ ุณูุชู ุญุฐู:"
echo "  ๐๏ธ  ูุงุชูุฑุฉ ุงูุดุฑูุฉ ุงูุฃู"
echo "  ๐๏ธ  ูุงุชูุฑุฉ ูุดุชุฑูุงุช ุงูุดุฑูุฉ ุงูุชุงุจุนุฉ"
echo "  ๐๏ธ  ุณุฌู PurchaseFromParent"
echo "  ๐ ูุฅุฑุฌุงุน ุฌููุน ุงููุฎุฒูู ุชููุงุฆูุงู"
echo ""

